function cov_22rza11mjy(){var path="/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/update-item-add.js";var hash="b16168bfbc7cb911c3f6d3a1ea5cb7548459df3d";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/update-item-add.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:43}},"1":{start:{line:2,column:41},end:{line:2,column:62}},"2":{start:{line:3,column:42},end:{line:3,column:71}},"3":{start:{line:5,column:0},end:{line:40,column:1}},"4":{start:{line:6,column:4},end:{line:6,column:37}},"5":{start:{line:7,column:4},end:{line:7,column:37}},"6":{start:{line:8,column:4},end:{line:8,column:37}},"7":{start:{line:10,column:17},end:{line:10,column:44}},"8":{start:{line:12,column:4},end:{line:12,column:62}},"9":{start:{line:12,column:17},end:{line:12,column:62}},"10":{start:{line:14,column:15},end:{line:14,column:49}},"11":{start:{line:16,column:4},end:{line:16,column:60}},"12":{start:{line:16,column:15},end:{line:16,column:60}},"13":{start:{line:18,column:4},end:{line:39,column:5}},"14":{start:{line:20,column:12},end:{line:20,column:45}},"15":{start:{line:32,column:8},end:{line:32,column:14}},"16":{start:{line:36,column:8},end:{line:36,column:95}},"17":{start:{line:38,column:8},end:{line:38,column:14}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:17},end:{line:5,column:18}},loc:{start:{line:5,column:51},end:{line:40,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:19,column:29},end:{line:19,column:30}},loc:{start:{line:20,column:12},end:{line:20,column:45}},line:20}},branchMap:{"0":{loc:{start:{line:12,column:4},end:{line:12,column:62}},type:"if",locations:[{start:{line:12,column:4},end:{line:12,column:62}},{start:{line:12,column:4},end:{line:12,column:62}}],line:12},"1":{loc:{start:{line:16,column:4},end:{line:16,column:60}},type:"if",locations:[{start:{line:16,column:4},end:{line:16,column:60}},{start:{line:16,column:4},end:{line:16,column:60}}],line:16},"2":{loc:{start:{line:18,column:4},end:{line:39,column:5}},type:"if",locations:[{start:{line:18,column:4},end:{line:39,column:5}},{start:{line:18,column:4},end:{line:39,column:5}}],line:18}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"b16168bfbc7cb911c3f6d3a1ea5cb7548459df3d"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_22rza11mjy=function(){return actualCoverage;};return actualCoverage;}cov_22rza11mjy();const{validate}=(cov_22rza11mjy().s[0]++,require('hoort-utils'));const{models:{Land,Item,User}}=(cov_22rza11mjy().s[1]++,require('hoort-data'));const{NotAllowedError,ContentError}=(cov_22rza11mjy().s[2]++,require('../../hoort-errors'));cov_22rza11mjy().s[3]++;module.exports=async(userId,landId,itemId)=>{cov_22rza11mjy().f[0]++;cov_22rza11mjy().s[4]++;validate.string(userId,'userId');cov_22rza11mjy().s[5]++;validate.string(landId,'landId');cov_22rza11mjy().s[6]++;validate.string(itemId,'itemId');let veggie=(cov_22rza11mjy().s[7]++,await Item.findById(itemId));cov_22rza11mjy().s[8]++;if(!veggie){cov_22rza11mjy().b[0][0]++;cov_22rza11mjy().s[9]++;throw new ContentError('item does not exist');}else{cov_22rza11mjy().b[0][1]++;}let land=(cov_22rza11mjy().s[10]++,await Land.findById(landId).lean());cov_22rza11mjy().s[11]++;if(!land){cov_22rza11mjy().b[1][0]++;cov_22rza11mjy().s[12]++;throw new ContentError('land does not exist');}else{cov_22rza11mjy().b[1][1]++;}cov_22rza11mjy().s[13]++;if(land.plantation.find(item=>{cov_22rza11mjy().f[1]++;cov_22rza11mjy().s[14]++;return item.veggie.toString()===itemId;})!==undefined){cov_22rza11mjy().b[2][0]++;cov_22rza11mjy().s[15]++;// land.id = land._id.toString()
// delete land._id
// delete land.__v
// land.plantation.forEach(plant => {
//     plant.id = plant._id.toString()
//     delete plant._id
// })
return;//land
}else{cov_22rza11mjy().b[2][1]++;cov_22rza11mjy().s[16]++;await Land.findByIdAndUpdate(landId,{$addToSet:{plantation:{veggie:itemId}}});// console.log(updatedLand)
cov_22rza11mjy().s[17]++;return;}};// module.exports = async (userId, landId, itemId) => {
//     validate.string(userId, 'userId')
//     validate.string(landId, 'landId')
//     validate.string(itemId, 'itemId')
//     let _veggie = await Item.findById(itemId)
//     if (!_veggie) throw new ContentError('item does not exist')
//     debugger
//     let land = await Land.findOne({ id: landId, plantation: { $elemMatch: { veggie: itemId } } })
//     if (land) return land
//     else return await Land.findByIdAndUpdate(landId, { $addToSet: { plantation: { veggie: itemId } } })
//     // return
// }
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVwZGF0ZS1pdGVtLWFkZC5qcyJdLCJuYW1lcyI6WyJ2YWxpZGF0ZSIsInJlcXVpcmUiLCJtb2RlbHMiLCJMYW5kIiwiSXRlbSIsIlVzZXIiLCJOb3RBbGxvd2VkRXJyb3IiLCJDb250ZW50RXJyb3IiLCJtb2R1bGUiLCJleHBvcnRzIiwidXNlcklkIiwibGFuZElkIiwiaXRlbUlkIiwic3RyaW5nIiwidmVnZ2llIiwiZmluZEJ5SWQiLCJsYW5kIiwibGVhbiIsInBsYW50YXRpb24iLCJmaW5kIiwiaXRlbSIsInRvU3RyaW5nIiwidW5kZWZpbmVkIiwiZmluZEJ5SWRBbmRVcGRhdGUiLCIkYWRkVG9TZXQiXSwibWFwcGluZ3MiOiJ5dkZBQUEsS0FBTSxDQUFFQSxRQUFGLDJCQUFlQyxPQUFPLENBQUMsYUFBRCxDQUF0QixDQUFOLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsSUFBRixDQUFRQyxJQUFSLENBQWNDLElBQWQsQ0FBViwyQkFBbUNKLE9BQU8sQ0FBQyxZQUFELENBQTFDLENBQU4sQ0FDQSxLQUFNLENBQUVLLGVBQUYsQ0FBbUJDLFlBQW5CLDJCQUFvQ04sT0FBTyxDQUFDLG9CQUFELENBQTNDLENBQU4sQyx3QkFFQU8sTUFBTSxDQUFDQyxPQUFQLENBQWlCLE1BQU9DLE1BQVAsQ0FBZUMsTUFBZixDQUF1QkMsTUFBdkIsR0FBa0MsaURBQy9DWixRQUFRLENBQUNhLE1BQVQsQ0FBZ0JILE1BQWhCLENBQXdCLFFBQXhCLEVBRCtDLHdCQUUvQ1YsUUFBUSxDQUFDYSxNQUFULENBQWdCRixNQUFoQixDQUF3QixRQUF4QixFQUYrQyx3QkFHL0NYLFFBQVEsQ0FBQ2EsTUFBVCxDQUFnQkQsTUFBaEIsQ0FBd0IsUUFBeEIsRUFFQSxHQUFJRSxDQUFBQSxNQUFNLDBCQUFHLEtBQU1WLENBQUFBLElBQUksQ0FBQ1csUUFBTCxDQUFjSCxNQUFkLENBQVQsQ0FBVixDQUwrQyx3QkFPL0MsR0FBSSxDQUFDRSxNQUFMLENBQWEseURBQU0sSUFBSVAsQ0FBQUEsWUFBSixDQUFpQixxQkFBakIsQ0FBTixDQUE2QyxDQUExRCxpQ0FFQSxHQUFJUyxDQUFBQSxJQUFJLDJCQUFHLEtBQU1iLENBQUFBLElBQUksQ0FBQ1ksUUFBTCxDQUFjSixNQUFkLEVBQXNCTSxJQUF0QixFQUFULENBQVIsQ0FUK0MseUJBVy9DLEdBQUksQ0FBQ0QsSUFBTCxDQUFXLDBEQUFNLElBQUlULENBQUFBLFlBQUosQ0FBaUIscUJBQWpCLENBQU4sQ0FBNkMsQ0FBeEQsaUNBWCtDLHlCQWEvQyxHQUNJUyxJQUFJLENBQUNFLFVBQUwsQ0FBZ0JDLElBQWhCLENBQXFCQyxJQUFJLEVBQ3JCLHdEQUFBQSxDQUFBQSxJQUFJLENBQUNOLE1BQUwsQ0FBWU8sUUFBWixLQUEyQlQsTUFBM0IsQ0FBaUMsQ0FEckMsSUFFTVUsU0FIVixDQUdxQixxREFFakI7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQSxPQUFPO0FBQ1YsQ0FmRCxJQWlCSyxxREFDRCxLQUFNbkIsQ0FBQUEsSUFBSSxDQUFDb0IsaUJBQUwsQ0FBdUJaLE1BQXZCLENBQStCLENBQUVhLFNBQVMsQ0FBRSxDQUFFTixVQUFVLENBQUUsQ0FBRUosTUFBTSxDQUFFRixNQUFWLENBQWQsQ0FBYixDQUEvQixDQUFOLENBQ0E7QUFGQyx5QkFHRCxPQUNILENBQ0osQ0FuQ0QsQ0FxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFFQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyB2YWxpZGF0ZSB9ID0gcmVxdWlyZSgnaG9vcnQtdXRpbHMnKVxuY29uc3QgeyBtb2RlbHM6IHsgTGFuZCwgSXRlbSwgVXNlciB9IH0gPSByZXF1aXJlKCdob29ydC1kYXRhJylcbmNvbnN0IHsgTm90QWxsb3dlZEVycm9yLCBDb250ZW50RXJyb3IgfSA9IHJlcXVpcmUoJy4uLy4uL2hvb3J0LWVycm9ycycpXG5cbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgKHVzZXJJZCwgbGFuZElkLCBpdGVtSWQpID0+IHtcbiAgICB2YWxpZGF0ZS5zdHJpbmcodXNlcklkLCAndXNlcklkJylcbiAgICB2YWxpZGF0ZS5zdHJpbmcobGFuZElkLCAnbGFuZElkJylcbiAgICB2YWxpZGF0ZS5zdHJpbmcoaXRlbUlkLCAnaXRlbUlkJylcblxuICAgIGxldCB2ZWdnaWUgPSBhd2FpdCBJdGVtLmZpbmRCeUlkKGl0ZW1JZClcblxuICAgIGlmICghdmVnZ2llKSB0aHJvdyBuZXcgQ29udGVudEVycm9yKCdpdGVtIGRvZXMgbm90IGV4aXN0JylcblxuICAgIGxldCBsYW5kID0gYXdhaXQgTGFuZC5maW5kQnlJZChsYW5kSWQpLmxlYW4oKVxuXG4gICAgaWYgKCFsYW5kKSB0aHJvdyBuZXcgQ29udGVudEVycm9yKCdsYW5kIGRvZXMgbm90IGV4aXN0JylcblxuICAgIGlmIChcbiAgICAgICAgbGFuZC5wbGFudGF0aW9uLmZpbmQoaXRlbSA9PlxuICAgICAgICAgICAgaXRlbS52ZWdnaWUudG9TdHJpbmcoKSA9PT0gaXRlbUlkXG4gICAgICAgICkgIT09IHVuZGVmaW5lZCkge1xuXG4gICAgICAgIC8vIGxhbmQuaWQgPSBsYW5kLl9pZC50b1N0cmluZygpXG4gICAgICAgIC8vIGRlbGV0ZSBsYW5kLl9pZFxuICAgICAgICAvLyBkZWxldGUgbGFuZC5fX3ZcblxuICAgICAgICAvLyBsYW5kLnBsYW50YXRpb24uZm9yRWFjaChwbGFudCA9PiB7XG4gICAgICAgIC8vICAgICBwbGFudC5pZCA9IHBsYW50Ll9pZC50b1N0cmluZygpXG4gICAgICAgIC8vICAgICBkZWxldGUgcGxhbnQuX2lkXG4gICAgICAgIC8vIH0pXG5cbiAgICAgICAgcmV0dXJuIC8vbGFuZFxuICAgIH1cblxuICAgIGVsc2Uge1xuICAgICAgICBhd2FpdCBMYW5kLmZpbmRCeUlkQW5kVXBkYXRlKGxhbmRJZCwgeyAkYWRkVG9TZXQ6IHsgcGxhbnRhdGlvbjogeyB2ZWdnaWU6IGl0ZW1JZCB9IH0gfSlcbiAgICAgICAgLy8gY29uc29sZS5sb2codXBkYXRlZExhbmQpXG4gICAgICAgIHJldHVyblxuICAgIH1cbn1cblxuLy8gbW9kdWxlLmV4cG9ydHMgPSBhc3luYyAodXNlcklkLCBsYW5kSWQsIGl0ZW1JZCkgPT4ge1xuLy8gICAgIHZhbGlkYXRlLnN0cmluZyh1c2VySWQsICd1c2VySWQnKVxuLy8gICAgIHZhbGlkYXRlLnN0cmluZyhsYW5kSWQsICdsYW5kSWQnKVxuLy8gICAgIHZhbGlkYXRlLnN0cmluZyhpdGVtSWQsICdpdGVtSWQnKVxuLy8gICAgIGxldCBfdmVnZ2llID0gYXdhaXQgSXRlbS5maW5kQnlJZChpdGVtSWQpXG5cbi8vICAgICBpZiAoIV92ZWdnaWUpIHRocm93IG5ldyBDb250ZW50RXJyb3IoJ2l0ZW0gZG9lcyBub3QgZXhpc3QnKVxuLy8gICAgIGRlYnVnZ2VyXG4vLyAgICAgbGV0IGxhbmQgPSBhd2FpdCBMYW5kLmZpbmRPbmUoeyBpZDogbGFuZElkLCBwbGFudGF0aW9uOiB7ICRlbGVtTWF0Y2g6IHsgdmVnZ2llOiBpdGVtSWQgfSB9IH0pXG5cbi8vICAgICBpZiAobGFuZCkgcmV0dXJuIGxhbmRcblxuLy8gICAgIGVsc2UgcmV0dXJuIGF3YWl0IExhbmQuZmluZEJ5SWRBbmRVcGRhdGUobGFuZElkLCB7ICRhZGRUb1NldDogeyBwbGFudGF0aW9uOiB7IHZlZ2dpZTogaXRlbUlkIH0gfSB9KVxuXG4vLyAgICAgLy8gcmV0dXJuXG4vLyB9Il19