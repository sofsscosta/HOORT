function cov_18bivw0mxu(){var path="/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/create-land.js";var hash="ab7d0b53dc8363f1e9f34721ff015d76b182ec8b";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/create-land.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:43}},"1":{start:{line:2,column:35},end:{line:2,column:56}},"2":{start:{line:3,column:28},end:{line:3,column:57}},"3":{start:{line:5,column:0},end:{line:29,column:1}},"4":{start:{line:7,column:4},end:{line:7,column:33}},"5":{start:{line:8,column:4},end:{line:8,column:37}},"6":{start:{line:9,column:4},end:{line:9,column:41}},"7":{start:{line:10,column:4},end:{line:10,column:41}},"8":{start:{line:11,column:4},end:{line:11,column:39}},"9":{start:{line:11,column:16},end:{line:11,column:39}},"10":{start:{line:13,column:15},end:{line:13,column:42}},"11":{start:{line:15,column:21},end:{line:18,column:7}},"12":{start:{line:16,column:19},end:{line:16,column:45}},"13":{start:{line:17,column:8},end:{line:17,column:24}},"14":{start:{line:20,column:4},end:{line:20,column:118}},"15":{start:{line:20,column:35},end:{line:20,column:118}},"16":{start:{line:22,column:4},end:{line:22,column:85}},"17":{start:{line:24,column:22},end:{line:24,column:40}},"18":{start:{line:26,column:4},end:{line:26,column:82}},"19":{start:{line:28,column:4},end:{line:28,column:10}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:17},end:{line:5,column:18}},loc:{start:{line:5,column:69},end:{line:29,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:15,column:54},end:{line:15,column:55}},loc:{start:{line:15,column:69},end:{line:18,column:5}},line:15}},branchMap:{"0":{loc:{start:{line:11,column:4},end:{line:11,column:39}},type:"if",locations:[{start:{line:11,column:4},end:{line:11,column:39}},{start:{line:11,column:4},end:{line:11,column:39}}],line:11},"1":{loc:{start:{line:20,column:4},end:{line:20,column:118}},type:"if",locations:[{start:{line:20,column:4},end:{line:20,column:118}},{start:{line:20,column:4},end:{line:20,column:118}}],line:20}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"ab7d0b53dc8363f1e9f34721ff015d76b182ec8b"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_18bivw0mxu=function(){return actualCoverage;};return actualCoverage;}cov_18bivw0mxu();const{validate}=(cov_18bivw0mxu().s[0]++,require('hoort-utils'));const{models:{Land,User}}=(cov_18bivw0mxu().s[1]++,require('hoort-data'));const{NotAllowedError}=(cov_18bivw0mxu().s[2]++,require('../../hoort-errors'));cov_18bivw0mxu().s[3]++;module.exports=async(name,userId,location,soiltype,scheme)=>{cov_18bivw0mxu().f[0]++;cov_18bivw0mxu().s[4]++;validate.string(name,'name');cov_18bivw0mxu().s[5]++;validate.string(userId,'userId');cov_18bivw0mxu().s[6]++;validate.string(location,'location');cov_18bivw0mxu().s[7]++;validate.string(soiltype,'soiltype');cov_18bivw0mxu().s[8]++;if(scheme){cov_18bivw0mxu().b[0][0]++;cov_18bivw0mxu().s[9]++;validate.scheme(scheme);}else{cov_18bivw0mxu().b[0][1]++;}let user=(cov_18bivw0mxu().s[10]++,await User.findById(userId));let landsNames=(cov_18bivw0mxu().s[11]++,await Promise.all(user.lands.map(async _land=>{cov_18bivw0mxu().f[1]++;let land=(cov_18bivw0mxu().s[12]++,await Land.findById(_land));cov_18bivw0mxu().s[13]++;return land.name;})));cov_18bivw0mxu().s[14]++;if(landsNames.includes(name)){cov_18bivw0mxu().b[1][0]++;cov_18bivw0mxu().s[15]++;throw new NotAllowedError(`You have already created a land with the name ${name}!`);}else{cov_18bivw0mxu().b[1][1]++;}cov_18bivw0mxu().s[16]++;_land=new Land({name,userId,location,soiltype,scheme,created:new Date()});let createdLand=(cov_18bivw0mxu().s[17]++,await _land.save());cov_18bivw0mxu().s[18]++;await User.findByIdAndUpdate(userId,{$addToSet:{lands:createdLand.id}});cov_18bivw0mxu().s[19]++;return;};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZS1sYW5kLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicmVxdWlyZSIsIm1vZGVscyIsIkxhbmQiLCJVc2VyIiwiTm90QWxsb3dlZEVycm9yIiwibW9kdWxlIiwiZXhwb3J0cyIsIm5hbWUiLCJ1c2VySWQiLCJsb2NhdGlvbiIsInNvaWx0eXBlIiwic2NoZW1lIiwic3RyaW5nIiwidXNlciIsImZpbmRCeUlkIiwibGFuZHNOYW1lcyIsIlByb21pc2UiLCJhbGwiLCJsYW5kcyIsIm1hcCIsIl9sYW5kIiwibGFuZCIsImluY2x1ZGVzIiwiY3JlYXRlZCIsIkRhdGUiLCJjcmVhdGVkTGFuZCIsInNhdmUiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRhZGRUb1NldCIsImlkIl0sIm1hcHBpbmdzIjoiNHFGQUFBLEtBQU0sQ0FBRUEsUUFBRiwyQkFBZUMsT0FBTyxDQUFDLGFBQUQsQ0FBdEIsQ0FBTixDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLElBQUYsQ0FBUUMsSUFBUixDQUFWLDJCQUE2QkgsT0FBTyxDQUFDLFlBQUQsQ0FBcEMsQ0FBTixDQUNBLEtBQU0sQ0FBRUksZUFBRiwyQkFBc0JKLE9BQU8sQ0FBQyxvQkFBRCxDQUE3QixDQUFOLEMsd0JBRUFLLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixNQUFPQyxJQUFQLENBQWFDLE1BQWIsQ0FBcUJDLFFBQXJCLENBQStCQyxRQUEvQixDQUF5Q0MsTUFBekMsR0FBb0QsaURBRWpFWixRQUFRLENBQUNhLE1BQVQsQ0FBZ0JMLElBQWhCLENBQXNCLE1BQXRCLEVBRmlFLHdCQUdqRVIsUUFBUSxDQUFDYSxNQUFULENBQWdCSixNQUFoQixDQUF3QixRQUF4QixFQUhpRSx3QkFJakVULFFBQVEsQ0FBQ2EsTUFBVCxDQUFnQkgsUUFBaEIsQ0FBMEIsVUFBMUIsRUFKaUUsd0JBS2pFVixRQUFRLENBQUNhLE1BQVQsQ0FBZ0JGLFFBQWhCLENBQTBCLFVBQTFCLEVBTGlFLHdCQU1qRSxHQUFJQyxNQUFKLENBQVksb0RBQUFaLFFBQVEsQ0FBQ1ksTUFBVCxDQUFnQkEsTUFBaEIsRUFBdUIsQ0FBbkMsaUNBRUEsR0FBSUUsQ0FBQUEsSUFBSSwyQkFBRyxLQUFNVixDQUFBQSxJQUFJLENBQUNXLFFBQUwsQ0FBY04sTUFBZCxDQUFULENBQVIsQ0FFQSxHQUFJTyxDQUFBQSxVQUFVLDJCQUFHLEtBQU1DLENBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSixJQUFJLENBQUNLLEtBQUwsQ0FBV0MsR0FBWCxDQUFlLEtBQU1DLENBQUFBLEtBQU4sRUFBZSx5QkFDN0QsR0FBSUMsQ0FBQUEsSUFBSSwyQkFBRyxLQUFNbkIsQ0FBQUEsSUFBSSxDQUFDWSxRQUFMLENBQWNNLEtBQWQsQ0FBVCxDQUFSLENBRDZELHlCQUU3RCxNQUFPQyxDQUFBQSxJQUFJLENBQUNkLElBQVosQ0FDSCxDQUhrQyxDQUFaLENBQVQsQ0FBZCxDQVZpRSx5QkFlakUsR0FBSVEsVUFBVSxDQUFDTyxRQUFYLENBQW9CZixJQUFwQixDQUFKLENBQStCLDBEQUFNLElBQUlILENBQUFBLGVBQUosQ0FBcUIsaURBQWdERyxJQUFLLEdBQTFFLENBQU4sQ0FBbUYsQ0FBbEgsaUNBZmlFLHlCQWlCakVhLEtBQUssQ0FBRyxHQUFJbEIsQ0FBQUEsSUFBSixDQUFTLENBQUVLLElBQUYsQ0FBUUMsTUFBUixDQUFnQkMsUUFBaEIsQ0FBMEJDLFFBQTFCLENBQW9DQyxNQUFwQyxDQUE0Q1ksT0FBTyxDQUFFLEdBQUlDLENBQUFBLElBQUosRUFBckQsQ0FBVCxDQUFSLENBRUEsR0FBSUMsQ0FBQUEsV0FBVywyQkFBRyxLQUFNTCxDQUFBQSxLQUFLLENBQUNNLElBQU4sRUFBVCxDQUFmLENBbkJpRSx5QkFxQmpFLEtBQU12QixDQUFBQSxJQUFJLENBQUN3QixpQkFBTCxDQUF1Qm5CLE1BQXZCLENBQStCLENBQUVvQixTQUFTLENBQUUsQ0FBRVYsS0FBSyxDQUFFTyxXQUFXLENBQUNJLEVBQXJCLENBQWIsQ0FBL0IsQ0FBTixDQXJCaUUseUJBdUJqRSxPQUNILENBeEJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyB2YWxpZGF0ZSB9ID0gcmVxdWlyZSgnaG9vcnQtdXRpbHMnKVxuY29uc3QgeyBtb2RlbHM6IHsgTGFuZCwgVXNlciB9IH0gPSByZXF1aXJlKCdob29ydC1kYXRhJylcbmNvbnN0IHsgTm90QWxsb3dlZEVycm9yIH0gPSByZXF1aXJlKCcuLi8uLi9ob29ydC1lcnJvcnMnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIChuYW1lLCB1c2VySWQsIGxvY2F0aW9uLCBzb2lsdHlwZSwgc2NoZW1lKSA9PiB7XG5cbiAgICB2YWxpZGF0ZS5zdHJpbmcobmFtZSwgJ25hbWUnKVxuICAgIHZhbGlkYXRlLnN0cmluZyh1c2VySWQsICd1c2VySWQnKVxuICAgIHZhbGlkYXRlLnN0cmluZyhsb2NhdGlvbiwgJ2xvY2F0aW9uJylcbiAgICB2YWxpZGF0ZS5zdHJpbmcoc29pbHR5cGUsICdzb2lsdHlwZScpXG4gICAgaWYgKHNjaGVtZSkgdmFsaWRhdGUuc2NoZW1lKHNjaGVtZSlcblxuICAgIGxldCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZCh1c2VySWQpXG5cbiAgICBsZXQgbGFuZHNOYW1lcyA9IGF3YWl0IFByb21pc2UuYWxsKHVzZXIubGFuZHMubWFwKGFzeW5jIF9sYW5kID0+IHtcbiAgICAgICAgbGV0IGxhbmQgPSBhd2FpdCBMYW5kLmZpbmRCeUlkKF9sYW5kKVxuICAgICAgICByZXR1cm4gbGFuZC5uYW1lXG4gICAgfSkpXG5cbiAgICBpZiAobGFuZHNOYW1lcy5pbmNsdWRlcyhuYW1lKSkgdGhyb3cgbmV3IE5vdEFsbG93ZWRFcnJvcihgWW91IGhhdmUgYWxyZWFkeSBjcmVhdGVkIGEgbGFuZCB3aXRoIHRoZSBuYW1lICR7bmFtZX0hYClcblxuICAgIF9sYW5kID0gbmV3IExhbmQoeyBuYW1lLCB1c2VySWQsIGxvY2F0aW9uLCBzb2lsdHlwZSwgc2NoZW1lLCBjcmVhdGVkOiBuZXcgRGF0ZSB9KVxuXG4gICAgbGV0IGNyZWF0ZWRMYW5kID0gYXdhaXQgX2xhbmQuc2F2ZSgpXG5cbiAgICBhd2FpdCBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKHVzZXJJZCwgeyAkYWRkVG9TZXQ6IHsgbGFuZHM6IGNyZWF0ZWRMYW5kLmlkIH0gfSlcblxuICAgIHJldHVyblxufVxuIl19