function cov_shw3uibjk(){var path="/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/update-land-planted.js";var hash="42d9bee0615762dba258fc00d85e1879a71916d8";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/update-land-planted.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:43}},"1":{start:{line:2,column:29},end:{line:2,column:50}},"2":{start:{line:4,column:0},end:{line:34,column:1}},"3":{start:{line:5,column:8},end:{line:5,column:41}},"4":{start:{line:6,column:8},end:{line:6,column:41}},"5":{start:{line:7,column:8},end:{line:7,column:31}},"6":{start:{line:9,column:19},end:{line:9,column:46}},"7":{start:{line:11,column:8},end:{line:11,column:62}},"8":{start:{line:11,column:19},end:{line:11,column:62}},"9":{start:{line:13,column:8},end:{line:32,column:69}},"10":{start:{line:14,column:16},end:{line:14,column:36}},"11":{start:{line:16,column:16},end:{line:16,column:33}},"12":{start:{line:18,column:16},end:{line:18,column:38}},"13":{start:{line:20,column:16},end:{line:23,column:18}},"14":{start:{line:21,column:24},end:{line:21,column:55}},"15":{start:{line:22,column:24},end:{line:22,column:40}},"16":{start:{line:25,column:16},end:{line:25,column:45}},"17":{start:{line:26,column:16},end:{line:26,column:31}},"18":{start:{line:27,column:16},end:{line:27,column:31}},"19":{start:{line:29,column:16},end:{line:29,column:27}},"20":{start:{line:32,column:13},end:{line:32,column:69}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:4,column:17},end:{line:4,column:18}},loc:{start:{line:4,column:51},end:{line:34,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:20,column:40},end:{line:20,column:41}},loc:{start:{line:20,column:49},end:{line:23,column:17}},line:20}},branchMap:{"0":{loc:{start:{line:11,column:8},end:{line:11,column:62}},type:"if",locations:[{start:{line:11,column:8},end:{line:11,column:62}},{start:{line:11,column:8},end:{line:11,column:62}}],line:11},"1":{loc:{start:{line:13,column:8},end:{line:32,column:69}},type:"if",locations:[{start:{line:13,column:8},end:{line:32,column:69}},{start:{line:13,column:8},end:{line:32,column:69}}],line:13}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"42d9bee0615762dba258fc00d85e1879a71916d8"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_shw3uibjk=function(){return actualCoverage;};return actualCoverage;}cov_shw3uibjk();const{validate}=(cov_shw3uibjk().s[0]++,require('hoort-utils'));const{models:{Land}}=(cov_shw3uibjk().s[1]++,require('hoort-data'));cov_shw3uibjk().s[2]++;module.exports=async(userId,landId,scheme)=>{cov_shw3uibjk().f[0]++;cov_shw3uibjk().s[3]++;validate.string(userId,'userId');cov_shw3uibjk().s[4]++;validate.string(landId,'landId');cov_shw3uibjk().s[5]++;validate.scheme(scheme);let land=(cov_shw3uibjk().s[6]++,await Land.findById(landId));cov_shw3uibjk().s[7]++;if(!land){cov_shw3uibjk().b[0][0]++;cov_shw3uibjk().s[8]++;throw new Error('This land doesn\'t exist');}else{cov_shw3uibjk().b[0][1]++;}cov_shw3uibjk().s[9]++;if(scheme.length===land.scheme.length){cov_shw3uibjk().b[1][0]++;cov_shw3uibjk().s[10]++;land.scheme=scheme;cov_shw3uibjk().s[11]++;await land.save();cov_shw3uibjk().s[12]++;land=land.toObject();cov_shw3uibjk().s[13]++;land.plantation.forEach(plant=>{cov_shw3uibjk().f[1]++;cov_shw3uibjk().s[14]++;plant.id=plant._id.toString();cov_shw3uibjk().s[15]++;delete plant._id;});cov_shw3uibjk().s[16]++;land.id=land._id.toString();cov_shw3uibjk().s[17]++;delete land._id;cov_shw3uibjk().s[18]++;delete land.__v;cov_shw3uibjk().s[19]++;return land;}else{cov_shw3uibjk().b[1][1]++;cov_shw3uibjk().s[20]++;throw new Error('Scheme divisions differ from original');}};// let veggies = []
// let newVeggies = []
// let otherNewVeggies = []
// return Land.findById(landId)
//     .then(async land => {
//         if (scheme.length === land.scheme.length) {
// for (let element of scheme) {
//     for (let i of element) {
//         if (!veggies.includes(i) && typeof i === 'string') {
//             veggies.push(i)
//         }
//     }
// }
// //console.log(veggies)
// for (let veggie of veggies) {
//     if (await Land.find({ plantation: { $elemMatch: { veggie }  } }) === null){
//         await Land.findByIdAndUpdate(landId, { $addToSet: { plantation: { veggie } } }).then(() => {})
//     }
// }
//         land.scheme = scheme
//         return land.save()
//             .then(land => land)
//     }
//     else throw new Error('Scheme divisions differ from original')
// }).then(land => land)
//, { $addToSet: { veggies: veggies } }
// for (let element of scheme) {
//     for (let i of element) {
//         if (!veggies.includes(i) && typeof i === 'string') {
//             veggies.push(i)
//         }
//     }
// }
// for (let i of veggies) newVeggies.push({veggie: i})
//console.log(newVeggies)
// land.scheme = scheme
// let plantation = land.plantation.toObject()//.then(plantations => plantations)
//let veggie = Land.find().
// debugger
// veggies.forEach(veggie => {
//     for (let element of plantation) {
//         if(veggies.includes(element.veggie.toString())) otherNewVeggies.push(element)
//         else if (!otherNewVeggies.includes(veggie)) otherNewVeggies.push(veggie)
//     }
// })
// console.log(plantation)
// veggies.forEach(veggie => {
//     for(let i = 0; i<plantation.length; i++){
//         // console.log(plantation[i].veggie.toString())
//         // console.log(veggie.veggie)
//         // console.log(plantation[i])
//         console.log(newVeggies.includes(land.plantation[i]))
//         if(plantation[i].veggie.toString() === veggie.veggie && !newVeggies.includes(land.plantation[i])) 
//             newVeggies.push(land.plantation[i])
//         else newVeggies.push(veggie)
//     }
//     console.log(newVeggies)
// })
//     let isThere = plantation.find(el => {
//         console.log(typeof veggie.veggie)
//         console.log(typeof el.veggie.toString())
//         console.log(el.veggie.toString() == veggie.veggie)
//         el.veggie.toString() == veggie.veggie
//     })
//         console.log(isThere)
//     if (isThere) newVeggies.push(land.plantation[land.plantation.indexOf(veggie)])
//     else newVeggies.push(veggie)
// })
//console.log(newVeggies)
// land.plantation = newVeggies
// let allVeggies = []
// veggies.forEach(veggie => allVeggies.push({_id: veggie}))
// console.log(allVeggies)
// if (!land.veggies.length) Land.findByIdAndUpdate(landId, { $set: { veggies: allVeggies } }).then(() => {})
// else land.veggies.forEach(veggie => {
//     if (!veggies.includes(veggie._id.toString())){
//         Land.findByIdAndUpdate(landId, { $pull: { veggies: {_id: veggie} } }).then(() => {})
//     }
//     else {
//         Land.findByIdAndUpdate(landId, { $addToSet: { veggies: {_id: veggie} } }).then(() => {})
//     }
//})
// veggies.forEach(veggie => {
//     Land.findByIdAndUpdate(landId, { $addToSet: { veggies: {_id: veggie} } }).then(() => {})
// })
//return land.save()
// .then(() => User.findById(userId))
// .then(user => {
//     user.lands.forEach(land => {
//         let notIncluded = []
//         return Land.findById(land.toString())
//             .then(_land => {
//                 for (let element of _land.veggies) {
//                     if (!user.veggies.includes(element._id)) {
//                         user.veggies.push(element._id)
//                     } else notIncluded.push(element._id)
//                 }
//                 console.log(notIncluded)
//                 console.log(user.veggies)
//                 notIncluded.forEach(el => { if(!user.veggies.includes(el)) user.veggies.splice(user.veggies.indexOf(el), 1) })
//                 return user.save()
//             })
//             .then(() => {})
//     })
// })
//.then(() => User.findByIdAndUpdate(userId, { $addToSet: { veggies: veggies } }))
//.then(() => )
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVwZGF0ZS1sYW5kLXBsYW50ZWQuanMiXSwibmFtZXMiOlsidmFsaWRhdGUiLCJyZXF1aXJlIiwibW9kZWxzIiwiTGFuZCIsIm1vZHVsZSIsImV4cG9ydHMiLCJ1c2VySWQiLCJsYW5kSWQiLCJzY2hlbWUiLCJzdHJpbmciLCJsYW5kIiwiZmluZEJ5SWQiLCJFcnJvciIsImxlbmd0aCIsInNhdmUiLCJ0b09iamVjdCIsInBsYW50YXRpb24iLCJmb3JFYWNoIiwicGxhbnQiLCJpZCIsIl9pZCIsInRvU3RyaW5nIiwiX192Il0sIm1hcHBpbmdzIjoiMnZGQUFBLEtBQU0sQ0FBRUEsUUFBRiwwQkFBZUMsT0FBTyxDQUFDLGFBQUQsQ0FBdEIsQ0FBTixDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLElBQUYsQ0FBViwwQkFBdUJGLE9BQU8sQ0FBQyxZQUFELENBQTlCLENBQU4sQyx1QkFFQUcsTUFBTSxDQUFDQyxPQUFQLENBQWlCLE1BQU9DLE1BQVAsQ0FBZUMsTUFBZixDQUF1QkMsTUFBdkIsR0FBa0MsK0NBQzNDUixRQUFRLENBQUNTLE1BQVQsQ0FBZ0JILE1BQWhCLENBQXdCLFFBQXhCLEVBRDJDLHVCQUUzQ04sUUFBUSxDQUFDUyxNQUFULENBQWdCRixNQUFoQixDQUF3QixRQUF4QixFQUYyQyx1QkFHM0NQLFFBQVEsQ0FBQ1EsTUFBVCxDQUFnQkEsTUFBaEIsRUFFQSxHQUFJRSxDQUFBQSxJQUFJLHlCQUFHLEtBQU1QLENBQUFBLElBQUksQ0FBQ1EsUUFBTCxDQUFjSixNQUFkLENBQVQsQ0FBUixDQUwyQyx1QkFPM0MsR0FBSSxDQUFDRyxJQUFMLENBQVcsdURBQU0sSUFBSUUsQ0FBQUEsS0FBSixDQUFVLDBCQUFWLENBQU4sQ0FBMkMsQ0FBdEQsZ0NBUDJDLHVCQVMzQyxHQUFJSixNQUFNLENBQUNLLE1BQVAsR0FBa0JILElBQUksQ0FBQ0YsTUFBTCxDQUFZSyxNQUFsQyxDQUEwQyxtREFDbENILElBQUksQ0FBQ0YsTUFBTCxDQUFjQSxNQUFkLENBRGtDLHdCQUdsQyxLQUFNRSxDQUFBQSxJQUFJLENBQUNJLElBQUwsRUFBTixDQUhrQyx3QkFLbENKLElBQUksQ0FBR0EsSUFBSSxDQUFDSyxRQUFMLEVBQVAsQ0FMa0Msd0JBT2xDTCxJQUFJLENBQUNNLFVBQUwsQ0FBZ0JDLE9BQWhCLENBQXdCQyxLQUFLLEVBQUksZ0RBQ3pCQSxLQUFLLENBQUNDLEVBQU4sQ0FBV0QsS0FBSyxDQUFDRSxHQUFOLENBQVVDLFFBQVYsRUFBWCxDQUR5Qix3QkFFekIsTUFBT0gsQ0FBQUEsS0FBSyxDQUFDRSxHQUFiLENBQ1AsQ0FIRCxFQVBrQyx3QkFZbENWLElBQUksQ0FBQ1MsRUFBTCxDQUFVVCxJQUFJLENBQUNVLEdBQUwsQ0FBU0MsUUFBVCxFQUFWLENBWmtDLHdCQWFsQyxNQUFPWCxDQUFBQSxJQUFJLENBQUNVLEdBQVosQ0Fia0Msd0JBY2xDLE1BQU9WLENBQUFBLElBQUksQ0FBQ1ksR0FBWixDQWRrQyx3QkFnQmxDLE1BQU9aLENBQUFBLElBQVAsQ0FDUCxDQWpCRCxJQW1CSyx3REFBTSxJQUFJRSxDQUFBQSxLQUFKLENBQVUsdUNBQVYsQ0FBTixDQUF3RCxDQUVwRSxDQTlCRCxDQWlDSTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFFWTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUVSO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVSO0FBT2dCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVSO0FBRVE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFLQTtBQUVBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFUjtBQUNZO0FBRUE7QUFFQTtBQUVBO0FBRUE7QUFFQTtBQUdBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgdmFsaWRhdGUgfSA9IHJlcXVpcmUoJ2hvb3J0LXV0aWxzJylcbmNvbnN0IHsgbW9kZWxzOiB7IExhbmQgfSB9ID0gcmVxdWlyZSgnaG9vcnQtZGF0YScpXG5cbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgKHVzZXJJZCwgbGFuZElkLCBzY2hlbWUpID0+IHtcbiAgICAgICAgdmFsaWRhdGUuc3RyaW5nKHVzZXJJZCwgJ3VzZXJJZCcpXG4gICAgICAgIHZhbGlkYXRlLnN0cmluZyhsYW5kSWQsICdsYW5kSWQnKVxuICAgICAgICB2YWxpZGF0ZS5zY2hlbWUoc2NoZW1lKVxuXG4gICAgICAgIGxldCBsYW5kID0gYXdhaXQgTGFuZC5maW5kQnlJZChsYW5kSWQpXG5cbiAgICAgICAgaWYgKCFsYW5kKSB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbGFuZCBkb2VzblxcJ3QgZXhpc3QnKVxuXG4gICAgICAgIGlmIChzY2hlbWUubGVuZ3RoID09PSBsYW5kLnNjaGVtZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBsYW5kLnNjaGVtZSA9IHNjaGVtZVxuXG4gICAgICAgICAgICAgICAgYXdhaXQgbGFuZC5zYXZlKClcblxuICAgICAgICAgICAgICAgIGxhbmQgPSBsYW5kLnRvT2JqZWN0KClcblxuICAgICAgICAgICAgICAgIGxhbmQucGxhbnRhdGlvbi5mb3JFYWNoKHBsYW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYW50LmlkID0gcGxhbnQuX2lkLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBwbGFudC5faWRcbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgbGFuZC5pZCA9IGxhbmQuX2lkLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICBkZWxldGUgbGFuZC5faWRcbiAgICAgICAgICAgICAgICBkZWxldGUgbGFuZC5fX3ZcblxuICAgICAgICAgICAgICAgIHJldHVybiBsYW5kXG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcignU2NoZW1lIGRpdmlzaW9ucyBkaWZmZXIgZnJvbSBvcmlnaW5hbCcpXG5cbn1cblxuXG4gICAgLy8gbGV0IHZlZ2dpZXMgPSBbXVxuICAgIC8vIGxldCBuZXdWZWdnaWVzID0gW11cbiAgICAvLyBsZXQgb3RoZXJOZXdWZWdnaWVzID0gW11cblxuXG5cbiAgICAvLyByZXR1cm4gTGFuZC5maW5kQnlJZChsYW5kSWQpXG4gICAgLy8gICAgIC50aGVuKGFzeW5jIGxhbmQgPT4ge1xuICAgIC8vICAgICAgICAgaWYgKHNjaGVtZS5sZW5ndGggPT09IGxhbmQuc2NoZW1lLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgLy8gZm9yIChsZXQgZWxlbWVudCBvZiBzY2hlbWUpIHtcbiAgICAgICAgICAgICAgICAvLyAgICAgZm9yIChsZXQgaSBvZiBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICBpZiAoIXZlZ2dpZXMuaW5jbHVkZXMoaSkgJiYgdHlwZW9mIGkgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgdmVnZ2llcy5wdXNoKGkpXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gICAgIH1cbiAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgLy8gLy9jb25zb2xlLmxvZyh2ZWdnaWVzKVxuXG4gICAgICAgICAgICAgICAgLy8gZm9yIChsZXQgdmVnZ2llIG9mIHZlZ2dpZXMpIHtcblxuICAgICAgICAgICAgICAgIC8vICAgICBpZiAoYXdhaXQgTGFuZC5maW5kKHsgcGxhbnRhdGlvbjogeyAkZWxlbU1hdGNoOiB7IHZlZ2dpZSB9ICB9IH0pID09PSBudWxsKXtcblxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgYXdhaXQgTGFuZC5maW5kQnlJZEFuZFVwZGF0ZShsYW5kSWQsIHsgJGFkZFRvU2V0OiB7IHBsYW50YXRpb246IHsgdmVnZ2llIH0gfSB9KS50aGVuKCgpID0+IHt9KVxuICAgICAgICAgICAgICAgIC8vICAgICB9XG4gICAgICAgICAgICAgICAgLy8gfVxuXG4gICAgICAgIC8vICAgICAgICAgbGFuZC5zY2hlbWUgPSBzY2hlbWVcblxuICAgICAgICAvLyAgICAgICAgIHJldHVybiBsYW5kLnNhdmUoKVxuICAgICAgICAvLyAgICAgICAgICAgICAudGhlbihsYW5kID0+IGxhbmQpXG4gICAgICAgIC8vICAgICB9XG4gICAgICAgIC8vICAgICBlbHNlIHRocm93IG5ldyBFcnJvcignU2NoZW1lIGRpdmlzaW9ucyBkaWZmZXIgZnJvbSBvcmlnaW5hbCcpXG5cbiAgICAgICAgLy8gfSkudGhlbihsYW5kID0+IGxhbmQpXG5cbi8vLCB7ICRhZGRUb1NldDogeyB2ZWdnaWVzOiB2ZWdnaWVzIH0gfVxuXG5cblxuXG5cblxuICAgICAgICAgICAgICAgIC8vIGZvciAobGV0IGVsZW1lbnQgb2Ygc2NoZW1lKSB7XG4gICAgICAgICAgICAgICAgLy8gICAgIGZvciAobGV0IGkgb2YgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgaWYgKCF2ZWdnaWVzLmluY2x1ZGVzKGkpICYmIHR5cGVvZiBpID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIHZlZ2dpZXMucHVzaChpKVxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vICAgICB9XG4gICAgICAgICAgICAgICAgLy8gfVxuXG4gICAgICAgICAgICAgICAgLy8gZm9yIChsZXQgaSBvZiB2ZWdnaWVzKSBuZXdWZWdnaWVzLnB1c2goe3ZlZ2dpZTogaX0pXG5cbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKG5ld1ZlZ2dpZXMpXG5cbiAgICAgICAgLy8gbGFuZC5zY2hlbWUgPSBzY2hlbWVcblxuICAgICAgICAgICAgICAgIC8vIGxldCBwbGFudGF0aW9uID0gbGFuZC5wbGFudGF0aW9uLnRvT2JqZWN0KCkvLy50aGVuKHBsYW50YXRpb25zID0+IHBsYW50YXRpb25zKVxuXG4gICAgICAgICAgICAgICAgLy9sZXQgdmVnZ2llID0gTGFuZC5maW5kKCkuXG5cbiAgICAgICAgICAgICAgICAvLyBkZWJ1Z2dlclxuICAgICAgICAgICAgICAgIC8vIHZlZ2dpZXMuZm9yRWFjaCh2ZWdnaWUgPT4ge1xuICAgICAgICAgICAgICAgIC8vICAgICBmb3IgKGxldCBlbGVtZW50IG9mIHBsYW50YXRpb24pIHtcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIGlmKHZlZ2dpZXMuaW5jbHVkZXMoZWxlbWVudC52ZWdnaWUudG9TdHJpbmcoKSkpIG90aGVyTmV3VmVnZ2llcy5wdXNoKGVsZW1lbnQpXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICBlbHNlIGlmICghb3RoZXJOZXdWZWdnaWVzLmluY2x1ZGVzKHZlZ2dpZSkpIG90aGVyTmV3VmVnZ2llcy5wdXNoKHZlZ2dpZSlcbiAgICAgICAgICAgICAgICAvLyAgICAgfVxuICAgICAgICAgICAgICAgIC8vIH0pXG5cbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhwbGFudGF0aW9uKVxuXG4gICAgICAgICAgICAgICAgLy8gdmVnZ2llcy5mb3JFYWNoKHZlZ2dpZSA9PiB7XG5cbiAgICAgICAgICAgICAgICAvLyAgICAgZm9yKGxldCBpID0gMDsgaTxwbGFudGF0aW9uLmxlbmd0aDsgaSsrKXtcblxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgLy8gY29uc29sZS5sb2cocGxhbnRhdGlvbltpXS52ZWdnaWUudG9TdHJpbmcoKSlcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIC8vIGNvbnNvbGUubG9nKHZlZ2dpZS52ZWdnaWUpXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAvLyBjb25zb2xlLmxvZyhwbGFudGF0aW9uW2ldKVxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgY29uc29sZS5sb2cobmV3VmVnZ2llcy5pbmNsdWRlcyhsYW5kLnBsYW50YXRpb25baV0pKVxuXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICBpZihwbGFudGF0aW9uW2ldLnZlZ2dpZS50b1N0cmluZygpID09PSB2ZWdnaWUudmVnZ2llICYmICFuZXdWZWdnaWVzLmluY2x1ZGVzKGxhbmQucGxhbnRhdGlvbltpXSkpIFxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIG5ld1ZlZ2dpZXMucHVzaChsYW5kLnBsYW50YXRpb25baV0pXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICBlbHNlIG5ld1ZlZ2dpZXMucHVzaCh2ZWdnaWUpXG4gICAgICAgICAgICAgICAgLy8gICAgIH1cblxuICAgICAgICAgICAgICAgIC8vICAgICBjb25zb2xlLmxvZyhuZXdWZWdnaWVzKVxuXG4gICAgICAgICAgICAgICAgLy8gfSlcblxuICAgICAgICAgICAgICAgIC8vICAgICBsZXQgaXNUaGVyZSA9IHBsYW50YXRpb24uZmluZChlbCA9PiB7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZyh0eXBlb2YgdmVnZ2llLnZlZ2dpZSlcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKHR5cGVvZiBlbC52ZWdnaWUudG9TdHJpbmcoKSlcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKGVsLnZlZ2dpZS50b1N0cmluZygpID09IHZlZ2dpZS52ZWdnaWUpXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICBlbC52ZWdnaWUudG9TdHJpbmcoKSA9PSB2ZWdnaWUudmVnZ2llXG4gICAgICAgICAgICAgICAgLy8gICAgIH0pXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZyhpc1RoZXJlKVxuICAgICAgICAgICAgICAgIC8vICAgICBpZiAoaXNUaGVyZSkgbmV3VmVnZ2llcy5wdXNoKGxhbmQucGxhbnRhdGlvbltsYW5kLnBsYW50YXRpb24uaW5kZXhPZih2ZWdnaWUpXSlcbiAgICAgICAgICAgICAgICAvLyAgICAgZWxzZSBuZXdWZWdnaWVzLnB1c2godmVnZ2llKVxuICAgICAgICAgICAgICAgIC8vIH0pXG5cbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKG5ld1ZlZ2dpZXMpXG5cblxuXG5cbiAgICAgICAgICAgICAgICAvLyBsYW5kLnBsYW50YXRpb24gPSBuZXdWZWdnaWVzXG5cblxuXG5cbiAgICAgICAgICAgICAgICAvLyBsZXQgYWxsVmVnZ2llcyA9IFtdXG5cbiAgICAgICAgICAgICAgICAvLyB2ZWdnaWVzLmZvckVhY2godmVnZ2llID0+IGFsbFZlZ2dpZXMucHVzaCh7X2lkOiB2ZWdnaWV9KSlcblxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGFsbFZlZ2dpZXMpXG5cbiAgICAgICAgICAgICAgICAvLyBpZiAoIWxhbmQudmVnZ2llcy5sZW5ndGgpIExhbmQuZmluZEJ5SWRBbmRVcGRhdGUobGFuZElkLCB7ICRzZXQ6IHsgdmVnZ2llczogYWxsVmVnZ2llcyB9IH0pLnRoZW4oKCkgPT4ge30pXG5cbiAgICAgICAgICAgICAgICAvLyBlbHNlIGxhbmQudmVnZ2llcy5mb3JFYWNoKHZlZ2dpZSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gICAgIGlmICghdmVnZ2llcy5pbmNsdWRlcyh2ZWdnaWUuX2lkLnRvU3RyaW5nKCkpKXtcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIExhbmQuZmluZEJ5SWRBbmRVcGRhdGUobGFuZElkLCB7ICRwdWxsOiB7IHZlZ2dpZXM6IHtfaWQ6IHZlZ2dpZX0gfSB9KS50aGVuKCgpID0+IHt9KVxuICAgICAgICAgICAgICAgIC8vICAgICB9XG4gICAgICAgICAgICAgICAgLy8gICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgTGFuZC5maW5kQnlJZEFuZFVwZGF0ZShsYW5kSWQsIHsgJGFkZFRvU2V0OiB7IHZlZ2dpZXM6IHtfaWQ6IHZlZ2dpZX0gfSB9KS50aGVuKCgpID0+IHt9KVxuICAgICAgICAgICAgICAgIC8vICAgICB9XG4gICAgICAgICAgICAgICAgLy99KVxuXG4gICAgICAgICAgICAgICAgLy8gdmVnZ2llcy5mb3JFYWNoKHZlZ2dpZSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gICAgIExhbmQuZmluZEJ5SWRBbmRVcGRhdGUobGFuZElkLCB7ICRhZGRUb1NldDogeyB2ZWdnaWVzOiB7X2lkOiB2ZWdnaWV9IH0gfSkudGhlbigoKSA9PiB7fSlcbiAgICAgICAgICAgICAgICAvLyB9KVxuXG4gICAgICAgIC8vcmV0dXJuIGxhbmQuc2F2ZSgpXG4gICAgICAgICAgICAgICAgICAgIC8vIC50aGVuKCgpID0+IFVzZXIuZmluZEJ5SWQodXNlcklkKSlcblxuICAgICAgICAgICAgICAgICAgICAvLyAudGhlbih1c2VyID0+IHtcblxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgdXNlci5sYW5kcy5mb3JFYWNoKGxhbmQgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgbGV0IG5vdEluY2x1ZGVkID0gW11cblxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiBMYW5kLmZpbmRCeUlkKGxhbmQudG9TdHJpbmcoKSlcblxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAudGhlbihfbGFuZCA9PiB7XG5cblxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgZm9yIChsZXQgZWxlbWVudCBvZiBfbGFuZC52ZWdnaWVzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICBpZiAoIXVzZXIudmVnZ2llcy5pbmNsdWRlcyhlbGVtZW50Ll9pZCkpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyLnZlZ2dpZXMucHVzaChlbGVtZW50Ll9pZClcblxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBub3RJbmNsdWRlZC5wdXNoKGVsZW1lbnQuX2lkKVxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhub3RJbmNsdWRlZClcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHVzZXIudmVnZ2llcylcblxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgbm90SW5jbHVkZWQuZm9yRWFjaChlbCA9PiB7IGlmKCF1c2VyLnZlZ2dpZXMuaW5jbHVkZXMoZWwpKSB1c2VyLnZlZ2dpZXMuc3BsaWNlKHVzZXIudmVnZ2llcy5pbmRleE9mKGVsKSwgMSkgfSlcblxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXIuc2F2ZSgpXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIC50aGVuKCgpID0+IHt9KVxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLy8gfSlcbiAgICAgICAgICAgICAgICAgICAgLy8udGhlbigoKSA9PiBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKHVzZXJJZCwgeyAkYWRkVG9TZXQ6IHsgdmVnZ2llczogdmVnZ2llcyB9IH0pKVxuICAgICAgICAgICAgICAgICAgICAvLy50aGVuKCgpID0+ICkiXX0=