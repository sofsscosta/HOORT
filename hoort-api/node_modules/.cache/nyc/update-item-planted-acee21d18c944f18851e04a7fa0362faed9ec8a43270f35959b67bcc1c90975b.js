function cov_ntt4h0jak(){var path="/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/update-item-planted.js";var hash="fb68bb60cf8818ec915e0a69732ff752c0aa9ed2";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/update-item-planted.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:43}},"1":{start:{line:2,column:35},end:{line:2,column:56}},"2":{start:{line:3,column:42},end:{line:3,column:71}},"3":{start:{line:4,column:15},end:{line:4,column:32}},"4":{start:{line:6,column:0},end:{line:102,column:1}},"5":{start:{line:7,column:4},end:{line:7,column:37}},"6":{start:{line:8,column:4},end:{line:8,column:37}},"7":{start:{line:9,column:4},end:{line:9,column:37}},"8":{start:{line:11,column:4},end:{line:11,column:12}},"9":{start:{line:13,column:17},end:{line:13,column:44}},"10":{start:{line:15,column:4},end:{line:15,column:62}},"11":{start:{line:15,column:17},end:{line:15,column:62}},"12":{start:{line:17,column:25},end:{line:17,column:57}},"13":{start:{line:19,column:4},end:{line:19,column:43}},"14":{start:{line:20,column:4},end:{line:20,column:43}},"15":{start:{line:22,column:4},end:{line:22,column:23}},"16":{start:{line:24,column:15},end:{line:24,column:42}},"17":{start:{line:26,column:4},end:{line:26,column:82}},"18":{start:{line:26,column:47},end:{line:26,column:81}},"19":{start:{line:28,column:4},end:{line:28,column:70}},"20":{start:{line:28,column:21},end:{line:28,column:70}},"21":{start:{line:30,column:4},end:{line:30,column:32}},"22":{start:{line:32,column:4},end:{line:32,column:22}},"23":{start:{line:34,column:16},end:{line:34,column:26}},"24":{start:{line:35,column:21},end:{line:35,column:31}},"25":{start:{line:36,column:21},end:{line:36,column:31}},"26":{start:{line:38,column:4},end:{line:38,column:53}},"27":{start:{line:39,column:4},end:{line:39,column:53}},"28":{start:{line:41,column:4},end:{line:41,column:86}},"29":{start:{line:42,column:4},end:{line:42,column:106}},"30":{start:{line:43,column:4},end:{line:43,column:106}},"31":{start:{line:45,column:4},end:{line:45,column:54}},"32":{start:{line:47,column:4},end:{line:47,column:21}},"33":{start:{line:49,column:4},end:{line:49,column:10}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:17},end:{line:6,column:18}},loc:{start:{line:6,column:51},end:{line:102,column:1}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:26,column:38},end:{line:26,column:39}},loc:{start:{line:26,column:47},end:{line:26,column:81}},line:26}},branchMap:{"0":{loc:{start:{line:15,column:4},end:{line:15,column:62}},type:"if",locations:[{start:{line:15,column:4},end:{line:15,column:62}},{start:{line:15,column:4},end:{line:15,column:62}}],line:15},"1":{loc:{start:{line:28,column:4},end:{line:28,column:70}},type:"if",locations:[{start:{line:28,column:4},end:{line:28,column:70}},{start:{line:28,column:4},end:{line:28,column:70}}],line:28}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"fb68bb60cf8818ec915e0a69732ff752c0aa9ed2"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_ntt4h0jak=function(){return actualCoverage;};return actualCoverage;}cov_ntt4h0jak();const{validate}=(cov_ntt4h0jak().s[0]++,require('hoort-utils'));const{models:{Land,Item}}=(cov_ntt4h0jak().s[1]++,require('hoort-data'));const{NotAllowedError,ContentError}=(cov_ntt4h0jak().s[2]++,require('../../hoort-errors'));const moment=(cov_ntt4h0jak().s[3]++,require('moment'));cov_ntt4h0jak().s[4]++;module.exports=async(userId,landId,itemId)=>{cov_ntt4h0jak().f[0]++;cov_ntt4h0jak().s[5]++;validate.string(userId,'userId');cov_ntt4h0jak().s[6]++;validate.string(landId,'landId');cov_ntt4h0jak().s[7]++;validate.string(itemId,'itemId');cov_ntt4h0jak().s[8]++;debugger;let veggie=(cov_ntt4h0jak().s[9]++,await Item.findById(itemId));cov_ntt4h0jak().s[10]++;if(!veggie){cov_ntt4h0jak().b[0][0]++;cov_ntt4h0jak().s[11]++;throw new ContentError('item does not exist');}else{cov_ntt4h0jak().b[0][1]++;}let growthDuration=(cov_ntt4h0jak().s[12]++,veggie.growthDuration.split('-'));cov_ntt4h0jak().s[13]++;minDuration=Number(growthDuration[0]);cov_ntt4h0jak().s[14]++;maxDuration=Number(growthDuration[1]);cov_ntt4h0jak().s[15]++;await veggie.save();let land=(cov_ntt4h0jak().s[16]++,await Land.findById(landId));cov_ntt4h0jak().s[17]++;plantation=land.plantation.find(plant=>{cov_ntt4h0jak().f[1]++;cov_ntt4h0jak().s[18]++;return plant.veggie.toString()===itemId;});cov_ntt4h0jak().s[19]++;if(!plantation){cov_ntt4h0jak().b[1][0]++;cov_ntt4h0jak().s[20]++;throw new Error('this item is not added to land');}else{cov_ntt4h0jak().b[1][1]++;}cov_ntt4h0jak().s[21]++;plantation.from=new Date();cov_ntt4h0jak().s[22]++;plantation.to='';let today=(cov_ntt4h0jak().s[23]++,new Date());let newdateMin=(cov_ntt4h0jak().s[24]++,new Date());let newdateMax=(cov_ntt4h0jak().s[25]++,new Date());cov_ntt4h0jak().s[26]++;newdateMin.setDate(today.getDate()+minDuration);cov_ntt4h0jak().s[27]++;newdateMax.setDate(today.getDate()+maxDuration);cov_ntt4h0jak().s[28]++;today=today.getDate()+"/"+(today.getMonth()+1)+"/"+today.getFullYear();cov_ntt4h0jak().s[29]++;newdateMin=newdateMin.getDate()+"/"+(newdateMin.getMonth()+1)+"/"+newdateMin.getFullYear();cov_ntt4h0jak().s[30]++;newdateMax=newdateMax.getDate()+"/"+(newdateMax.getMonth()+1)+"/"+newdateMax.getFullYear();cov_ntt4h0jak().s[31]++;plantation.estTime=`${newdateMin}-${newdateMax}`;cov_ntt4h0jak().s[32]++;await land.save();cov_ntt4h0jak().s[33]++;return;// return Land.findById(landId)//.populate('plantation', 'from')
//     .then(land => {
//         debugger
//         plantation = land.plantation.find(plant => plant.veggie.toString() === itemId)
//         plantation.from = new Date()
//         plantation.to = ''
//         return land.save()
//     })
//     .then(() => {})
// let veggie, growthDuration, minDuration, maxDuration
// return Item.findById(itemId)
//     .then(item => { 
//         if(!item) throw new ContentError('item does not exist')
//         growthDuration = item.growthDuration
//         let _growthDuration = growthDuration.split('-')
//         minDuration = Number(_growthDuration[0])
//         maxDuration = Number(_growthDuration[1])
//     })
//     .then(() => Land.findById(landId))
//     .then(land => {             
//         veggie = land.veggies.find(veggie => veggie._id.toString() === itemId)
//         if(!veggie) throw new Error('this veggie is not on this land')
//         let today = new Date()
//         let newdateMin = new Date()
//         let newdateMax = new Date()
//         newdateMin.setDate(today.getDate() + minDuration)
//         newdateMax.setDate(today.getDate() + maxDuration)
//         today = today.getDate() + "/" + (today.getMonth() + 1) + "/" + today.getFullYear()
//         newdateMin = newdateMin.getDate() + "/" + (newdateMin.getMonth() + 1) + "/" + newdateMin.getFullYear()
//         newdateMax = newdateMax.getDate() + "/" + (newdateMax.getMonth() + 1) + "/" + newdateMax.getFullYear()
//         land.veggies[land.veggies.indexOf(veggie)].estTime = `${newdateMin}-${newdateMax}`
//         land.veggies[land.veggies.indexOf(veggie)].state = "planted"
//         land.veggies[land.veggies.indexOf(veggie)].planted = new Date()
//         return land.save()
//     })
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVwZGF0ZS1pdGVtLXBsYW50ZWQuanMiXSwibmFtZXMiOlsidmFsaWRhdGUiLCJyZXF1aXJlIiwibW9kZWxzIiwiTGFuZCIsIkl0ZW0iLCJOb3RBbGxvd2VkRXJyb3IiLCJDb250ZW50RXJyb3IiLCJtb21lbnQiLCJtb2R1bGUiLCJleHBvcnRzIiwidXNlcklkIiwibGFuZElkIiwiaXRlbUlkIiwic3RyaW5nIiwidmVnZ2llIiwiZmluZEJ5SWQiLCJncm93dGhEdXJhdGlvbiIsInNwbGl0IiwibWluRHVyYXRpb24iLCJOdW1iZXIiLCJtYXhEdXJhdGlvbiIsInNhdmUiLCJsYW5kIiwicGxhbnRhdGlvbiIsImZpbmQiLCJwbGFudCIsInRvU3RyaW5nIiwiRXJyb3IiLCJmcm9tIiwiRGF0ZSIsInRvIiwidG9kYXkiLCJuZXdkYXRlTWluIiwibmV3ZGF0ZU1heCIsInNldERhdGUiLCJnZXREYXRlIiwiZ2V0TW9udGgiLCJnZXRGdWxsWWVhciIsImVzdFRpbWUiXSwibWFwcGluZ3MiOiI4aUhBQUEsS0FBTSxDQUFFQSxRQUFGLDBCQUFlQyxPQUFPLENBQUMsYUFBRCxDQUF0QixDQUFOLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsSUFBRixDQUFRQyxJQUFSLENBQVYsMEJBQTZCSCxPQUFPLENBQUMsWUFBRCxDQUFwQyxDQUFOLENBQ0EsS0FBTSxDQUFFSSxlQUFGLENBQW1CQyxZQUFuQiwwQkFBb0NMLE9BQU8sQ0FBQyxvQkFBRCxDQUEzQyxDQUFOLENBQ0EsS0FBTU0sQ0FBQUEsTUFBTSx5QkFBR04sT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFaLEMsdUJBRUFPLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixNQUFPQyxNQUFQLENBQWVDLE1BQWYsQ0FBdUJDLE1BQXZCLEdBQWtDLCtDQUMvQ1osUUFBUSxDQUFDYSxNQUFULENBQWdCSCxNQUFoQixDQUF3QixRQUF4QixFQUQrQyx1QkFFL0NWLFFBQVEsQ0FBQ2EsTUFBVCxDQUFnQkYsTUFBaEIsQ0FBd0Is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QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDSCxDQWhHRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgdmFsaWRhdGUgfSA9IHJlcXVpcmUoJ2hvb3J0LXV0aWxzJylcbmNvbnN0IHsgbW9kZWxzOiB7IExhbmQsIEl0ZW0gfSB9ID0gcmVxdWlyZSgnaG9vcnQtZGF0YScpXG5jb25zdCB7IE5vdEFsbG93ZWRFcnJvciwgQ29udGVudEVycm9yIH0gPSByZXF1aXJlKCcuLi8uLi9ob29ydC1lcnJvcnMnKVxuY29uc3QgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAodXNlcklkLCBsYW5kSWQsIGl0ZW1JZCkgPT4ge1xuICAgIHZhbGlkYXRlLnN0cmluZyh1c2VySWQsICd1c2VySWQnKVxuICAgIHZhbGlkYXRlLnN0cmluZyhsYW5kSWQsICdsYW5kSWQnKVxuICAgIHZhbGlkYXRlLnN0cmluZyhpdGVtSWQsICdpdGVtSWQnKVxuXG4gICAgZGVidWdnZXJcblxuICAgIGxldCB2ZWdnaWUgPSBhd2FpdCBJdGVtLmZpbmRCeUlkKGl0ZW1JZClcblxuICAgIGlmICghdmVnZ2llKSB0aHJvdyBuZXcgQ29udGVudEVycm9yKCdpdGVtIGRvZXMgbm90IGV4aXN0JylcblxuICAgIGxldCBncm93dGhEdXJhdGlvbiA9IHZlZ2dpZS5ncm93dGhEdXJhdGlvbi5zcGxpdCgnLScpXG5cbiAgICBtaW5EdXJhdGlvbiA9IE51bWJlcihncm93dGhEdXJhdGlvblswXSlcbiAgICBtYXhEdXJhdGlvbiA9IE51bWJlcihncm93dGhEdXJhdGlvblsxXSlcblxuICAgIGF3YWl0IHZlZ2dpZS5zYXZlKClcblxuICAgIGxldCBsYW5kID0gYXdhaXQgTGFuZC5maW5kQnlJZChsYW5kSWQpXG5cbiAgICBwbGFudGF0aW9uID0gbGFuZC5wbGFudGF0aW9uLmZpbmQocGxhbnQgPT4gcGxhbnQudmVnZ2llLnRvU3RyaW5nKCkgPT09IGl0ZW1JZClcblxuICAgIGlmICghcGxhbnRhdGlvbikgdGhyb3cgbmV3IEVycm9yKCd0aGlzIGl0ZW0gaXMgbm90IGFkZGVkIHRvIGxhbmQnKVxuXG4gICAgcGxhbnRhdGlvbi5mcm9tID0gbmV3IERhdGUoKVxuXG4gICAgcGxhbnRhdGlvbi50byA9ICcnXG5cbiAgICBsZXQgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gICAgbGV0IG5ld2RhdGVNaW4gPSBuZXcgRGF0ZSgpXG4gICAgbGV0IG5ld2RhdGVNYXggPSBuZXcgRGF0ZSgpXG5cbiAgICBuZXdkYXRlTWluLnNldERhdGUodG9kYXkuZ2V0RGF0ZSgpICsgbWluRHVyYXRpb24pXG4gICAgbmV3ZGF0ZU1heC5zZXREYXRlKHRvZGF5LmdldERhdGUoKSArIG1heER1cmF0aW9uKVxuXG4gICAgdG9kYXkgPSB0b2RheS5nZXREYXRlKCkgKyBcIi9cIiArICh0b2RheS5nZXRNb250aCgpICsgMSkgKyBcIi9cIiArIHRvZGF5LmdldEZ1bGxZZWFyKClcbiAgICBuZXdkYXRlTWluID0gbmV3ZGF0ZU1pbi5nZXREYXRlKCkgKyBcIi9cIiArIChuZXdkYXRlTWluLmdldE1vbnRoKCkgKyAxKSArIFwiL1wiICsgbmV3ZGF0ZU1pbi5nZXRGdWxsWWVhcigpXG4gICAgbmV3ZGF0ZU1heCA9IG5ld2RhdGVNYXguZ2V0RGF0ZSgpICsgXCIvXCIgKyAobmV3ZGF0ZU1heC5nZXRNb250aCgpICsgMSkgKyBcIi9cIiArIG5ld2RhdGVNYXguZ2V0RnVsbFllYXIoKVxuXG4gICAgcGxhbnRhdGlvbi5lc3RUaW1lID0gYCR7bmV3ZGF0ZU1pbn0tJHtuZXdkYXRlTWF4fWBcblxuICAgIGF3YWl0IGxhbmQuc2F2ZSgpXG5cbiAgICByZXR1cm5cblxuICAgIC8vIHJldHVybiBMYW5kLmZpbmRCeUlkKGxhbmRJZCkvLy5wb3B1bGF0ZSgncGxhbnRhdGlvbicsICdmcm9tJylcbiAgICAvLyAgICAgLnRoZW4obGFuZCA9PiB7XG4gICAgLy8gICAgICAgICBkZWJ1Z2dlclxuICAgIC8vICAgICAgICAgcGxhbnRhdGlvbiA9IGxhbmQucGxhbnRhdGlvbi5maW5kKHBsYW50ID0+IHBsYW50LnZlZ2dpZS50b1N0cmluZygpID09PSBpdGVtSWQpXG5cbiAgICAvLyAgICAgICAgIHBsYW50YXRpb24uZnJvbSA9IG5ldyBEYXRlKClcblxuICAgIC8vICAgICAgICAgcGxhbnRhdGlvbi50byA9ICcnXG5cbiAgICAvLyAgICAgICAgIHJldHVybiBsYW5kLnNhdmUoKVxuICAgIC8vICAgICB9KVxuICAgIC8vICAgICAudGhlbigoKSA9PiB7fSlcblxuXG4gICAgLy8gbGV0IHZlZ2dpZSwgZ3Jvd3RoRHVyYXRpb24sIG1pbkR1cmF0aW9uLCBtYXhEdXJhdGlvblxuXG4gICAgLy8gcmV0dXJuIEl0ZW0uZmluZEJ5SWQoaXRlbUlkKVxuICAgIC8vICAgICAudGhlbihpdGVtID0+IHsgXG4gICAgLy8gICAgICAgICBpZighaXRlbSkgdGhyb3cgbmV3IENvbnRlbnRFcnJvcignaXRlbSBkb2VzIG5vdCBleGlzdCcpXG5cbiAgICAvLyAgICAgICAgIGdyb3d0aER1cmF0aW9uID0gaXRlbS5ncm93dGhEdXJhdGlvblxuXG4gICAgLy8gICAgICAgICBsZXQgX2dyb3d0aER1cmF0aW9uID0gZ3Jvd3RoRHVyYXRpb24uc3BsaXQoJy0nKVxuXG4gICAgLy8gICAgICAgICBtaW5EdXJhdGlvbiA9IE51bWJlcihfZ3Jvd3RoRHVyYXRpb25bMF0pXG4gICAgLy8gICAgICAgICBtYXhEdXJhdGlvbiA9IE51bWJlcihfZ3Jvd3RoRHVyYXRpb25bMV0pXG5cbiAgICAvLyAgICAgfSlcbiAgICAvLyAgICAgLnRoZW4oKCkgPT4gTGFuZC5maW5kQnlJZChsYW5kSWQpKVxuICAgIC8vICAgICAudGhlbihsYW5kID0+IHsgICAgICAgICAgICAgXG4gICAgLy8gICAgICAgICB2ZWdnaWUgPSBsYW5kLnZlZ2dpZXMuZmluZCh2ZWdnaWUgPT4gdmVnZ2llLl9pZC50b1N0cmluZygpID09PSBpdGVtSWQpXG5cbiAgICAvLyAgICAgICAgIGlmKCF2ZWdnaWUpIHRocm93IG5ldyBFcnJvcigndGhpcyB2ZWdnaWUgaXMgbm90IG9uIHRoaXMgbGFuZCcpXG5cbiAgICAvLyAgICAgICAgIGxldCB0b2RheSA9IG5ldyBEYXRlKClcbiAgICAvLyAgICAgICAgIGxldCBuZXdkYXRlTWluID0gbmV3IERhdGUoKVxuICAgIC8vICAgICAgICAgbGV0IG5ld2RhdGVNYXggPSBuZXcgRGF0ZSgpXG5cbiAgICAvLyAgICAgICAgIG5ld2RhdGVNaW4uc2V0RGF0ZSh0b2RheS5nZXREYXRlKCkgKyBtaW5EdXJhdGlvbilcbiAgICAvLyAgICAgICAgIG5ld2RhdGVNYXguc2V0RGF0ZSh0b2RheS5nZXREYXRlKCkgKyBtYXhEdXJhdGlvbilcblxuICAgIC8vICAgICAgICAgdG9kYXkgPSB0b2RheS5nZXREYXRlKCkgKyBcIi9cIiArICh0b2RheS5nZXRNb250aCgpICsgMSkgKyBcIi9cIiArIHRvZGF5LmdldEZ1bGxZZWFyKClcbiAgICAvLyAgICAgICAgIG5ld2RhdGVNaW4gPSBuZXdkYXRlTWluLmdldERhdGUoKSArIFwiL1wiICsgKG5ld2RhdGVNaW4uZ2V0TW9udGgoKSArIDEpICsgXCIvXCIgKyBuZXdkYXRlTWluLmdldEZ1bGxZZWFyKClcbiAgICAvLyAgICAgICAgIG5ld2RhdGVNYXggPSBuZXdkYXRlTWF4LmdldERhdGUoKSArIFwiL1wiICsgKG5ld2RhdGVNYXguZ2V0TW9udGgoKSArIDEpICsgXCIvXCIgKyBuZXdkYXRlTWF4LmdldEZ1bGxZZWFyKClcblxuICAgIC8vICAgICAgICAgbGFuZC52ZWdnaWVzW2xhbmQudmVnZ2llcy5pbmRleE9mKHZlZ2dpZSldLmVzdFRpbWUgPSBgJHtuZXdkYXRlTWlufS0ke25ld2RhdGVNYXh9YFxuICAgIC8vICAgICAgICAgbGFuZC52ZWdnaWVzW2xhbmQudmVnZ2llcy5pbmRleE9mKHZlZ2dpZSldLnN0YXRlID0gXCJwbGFudGVkXCJcbiAgICAvLyAgICAgICAgIGxhbmQudmVnZ2llc1tsYW5kLnZlZ2dpZXMuaW5kZXhPZih2ZWdnaWUpXS5wbGFudGVkID0gbmV3IERhdGUoKVxuXG4gICAgLy8gICAgICAgICByZXR1cm4gbGFuZC5zYXZlKClcbiAgICAvLyAgICAgfSlcbn1cbiJdfQ==