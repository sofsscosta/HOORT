function cov_1k9muysgdo(){var path="/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/authenticate-user.js";var hash="42ac8acb4488311c7682b9ef61f1c1b2299a01a1";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/authenticate-user.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:43}},"1":{start:{line:2,column:29},end:{line:2,column:50}},"2":{start:{line:3,column:28},end:{line:3,column:57}},"3":{start:{line:4,column:15},end:{line:4,column:34}},"4":{start:{line:6,column:0},end:{line:27,column:1}},"5":{start:{line:8,column:4},end:{line:8,column:35}},"6":{start:{line:9,column:4},end:{line:9,column:25}},"7":{start:{line:10,column:4},end:{line:10,column:41}},"8":{start:{line:12,column:4},end:{line:26,column:10}},"9":{start:{line:14,column:12},end:{line:14,column:69}},"10":{start:{line:14,column:23},end:{line:14,column:69}},"11":{start:{line:16,column:12},end:{line:25,column:37}},"12":{start:{line:19,column:20},end:{line:19,column:86}},"13":{start:{line:19,column:40},end:{line:19,column:86}},"14":{start:{line:21,column:20},end:{line:21,column:49}},"15":{start:{line:23,column:20},end:{line:23,column:38}},"16":{start:{line:25,column:34},end:{line:25,column:36}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:17},end:{line:6,column:18}},loc:{start:{line:6,column:38},end:{line:27,column:1}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:13,column:14},end:{line:13,column:15}},loc:{start:{line:13,column:22},end:{line:26,column:9}},line:13},"2":{name:"(anonymous_2)",decl:{start:{line:17,column:22},end:{line:17,column:23}},loc:{start:{line:17,column:39},end:{line:24,column:17}},line:17},"3":{name:"(anonymous_3)",decl:{start:{line:25,column:22},end:{line:25,column:23}},loc:{start:{line:25,column:34},end:{line:25,column:36}},line:25}},branchMap:{"0":{loc:{start:{line:14,column:12},end:{line:14,column:69}},type:"if",locations:[{start:{line:14,column:12},end:{line:14,column:69}},{start:{line:14,column:12},end:{line:14,column:69}}],line:14},"1":{loc:{start:{line:19,column:20},end:{line:19,column:86}},type:"if",locations:[{start:{line:19,column:20},end:{line:19,column:86}},{start:{line:19,column:20},end:{line:19,column:86}}],line:19}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"42ac8acb4488311c7682b9ef61f1c1b2299a01a1"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1k9muysgdo=function(){return actualCoverage;};return actualCoverage;}cov_1k9muysgdo();const{validate}=(cov_1k9muysgdo().s[0]++,require('hoort-utils'));const{models:{User}}=(cov_1k9muysgdo().s[1]++,require('hoort-data'));const{NotAllowedError}=(cov_1k9muysgdo().s[2]++,require('../../hoort-errors'));const bcrypt=(cov_1k9muysgdo().s[3]++,require('bcryptjs'));cov_1k9muysgdo().s[4]++;module.exports=(email,password)=>{cov_1k9muysgdo().f[0]++;cov_1k9muysgdo().s[5]++;validate.string(email,'email');cov_1k9muysgdo().s[6]++;validate.email(email);cov_1k9muysgdo().s[7]++;validate.string(password,'password');cov_1k9muysgdo().s[8]++;return User.findOne({email}).then(user=>{cov_1k9muysgdo().f[1]++;cov_1k9muysgdo().s[9]++;if(!user){cov_1k9muysgdo().b[0][0]++;cov_1k9muysgdo().s[10]++;throw new NotAllowedError(`wrong credentials`);}else{cov_1k9muysgdo().b[0][1]++;}cov_1k9muysgdo().s[11]++;return bcrypt.compare(password,user.password).then(validPassword=>{cov_1k9muysgdo().f[2]++;cov_1k9muysgdo().s[12]++;if(!validPassword){cov_1k9muysgdo().b[1][0]++;cov_1k9muysgdo().s[13]++;throw new NotAllowedError(`wrong credentials`);}else{cov_1k9muysgdo().b[1][1]++;}cov_1k9muysgdo().s[14]++;user.authenticated=new Date();cov_1k9muysgdo().s[15]++;return user.save();}).then(({id})=>{cov_1k9muysgdo().f[3]++;cov_1k9muysgdo().s[16]++;return id;});});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0ZS11c2VyLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicmVxdWlyZSIsIm1vZGVscyIsIlVzZXIiLCJOb3RBbGxvd2VkRXJyb3IiLCJiY3J5cHQiLCJtb2R1bGUiLCJleHBvcnRzIiwiZW1haWwiLCJwYXNzd29yZCIsInN0cmluZyIsImZpbmRPbmUiLCJ0aGVuIiwidXNlciIsImNvbXBhcmUiLCJ2YWxpZFBhc3N3b3JkIiwiYXV0aGVudGljYXRlZCIsIkRhdGUiLCJzYXZlIiwiaWQiXSwibWFwcGluZ3MiOiJvekZBQUEsS0FBTSxDQUFFQSxRQUFGLDJCQUFlQyxPQUFPLENBQUMsYUFBRCxDQUF0QixDQUFOLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsSUFBRixDQUFWLDJCQUF1QkYsT0FBTyxDQUFDLFlBQUQsQ0FBOUIsQ0FBTixDQUNBLEtBQU0sQ0FBRUcsZUFBRiwyQkFBc0JILE9BQU8sQ0FBQyxvQkFBRCxDQUE3QixDQUFOLENBQ0EsS0FBTUksQ0FBQUEsTUFBTSwwQkFBR0osT0FBTyxDQUFDLFVBQUQsQ0FBVixDQUFaLEMsd0JBRUFLLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixDQUFDQyxLQUFELENBQVFDLFFBQVIsR0FBcUIsaURBRWxDVCxRQUFRLENBQUNVLE1BQVQsQ0FBZ0JGLEtBQWhCLENBQXVCLE9BQXZCLEVBRmtDLHdCQUdsQ1IsUUFBUSxDQUFDUSxLQUFULENBQWVBLEtBQWYsRUFIa0Msd0JBSWxDUixRQUFRLENBQUNVLE1BQVQsQ0FBZ0JELFFBQWhCLENBQTBCLFVBQTFCLEVBSmtDLHdCQU1sQyxNQUFPTixDQUFBQSxJQUFJLENBQUNRLE9BQUwsQ0FBYSxDQUFFSCxLQUFGLENBQWIsRUFDRkksSUFERSxDQUNHQyxJQUFJLEVBQUksaURBQ1YsR0FBSSxDQUFDQSxJQUFMLENBQVcsMERBQU0sSUFBSVQsQ0FBQUEsZUFBSixDQUFxQixtQkFBckIsQ0FBTixDQUE4QyxDQUF6RCxpQ0FEVSx5QkFHVixNQUFPQyxDQUFBQSxNQUFNLENBQUNTLE9BQVAsQ0FBZUwsUUFBZixDQUF5QkksSUFBSSxDQUFDSixRQUE5QixFQUNGRyxJQURFLENBQ0dHLGFBQWEsRUFBSSxrREFFbkIsR0FBSSxDQUFDQSxhQUFMLENBQW9CLDBEQUFNLElBQUlYLENBQUFBLGVBQUosQ0FBcUIsbUJBQXJCLENBQU4sQ0FBOEMsQ0FBbEUsaUNBRm1CLHlCQUluQlMsSUFBSSxDQUFDRyxhQUFMLENBQXFCLEdBQUlDLENBQUFBLElBQUosRUFBckIsQ0FKbUIseUJBTW5CLE1BQU9KLENBQUFBLElBQUksQ0FBQ0ssSUFBTCxFQUFQLENBQ0gsQ0FSRSxFQVNGTixJQVRFLENBU0csQ0FBQyxDQUFFTyxFQUFGLENBQUQsR0FBWUEsd0RBQUFBLENBQUFBLEVBQUUsRUFUakIsQ0FBUCxDQVVILENBZEUsQ0FBUCxDQWVILENBckJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyB2YWxpZGF0ZSB9ID0gcmVxdWlyZSgnaG9vcnQtdXRpbHMnKVxuY29uc3QgeyBtb2RlbHM6IHsgVXNlciB9IH0gPSByZXF1aXJlKCdob29ydC1kYXRhJylcbmNvbnN0IHsgTm90QWxsb3dlZEVycm9yIH0gPSByZXF1aXJlKCcuLi8uLi9ob29ydC1lcnJvcnMnKVxuY29uc3QgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0anMnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IChlbWFpbCwgcGFzc3dvcmQpID0+IHtcblxuICAgIHZhbGlkYXRlLnN0cmluZyhlbWFpbCwgJ2VtYWlsJylcbiAgICB2YWxpZGF0ZS5lbWFpbChlbWFpbClcbiAgICB2YWxpZGF0ZS5zdHJpbmcocGFzc3dvcmQsICdwYXNzd29yZCcpXG5cbiAgICByZXR1cm4gVXNlci5maW5kT25lKHsgZW1haWwgfSlcbiAgICAgICAgLnRoZW4odXNlciA9PiB7XG4gICAgICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBOb3RBbGxvd2VkRXJyb3IoYHdyb25nIGNyZWRlbnRpYWxzYClcblxuICAgICAgICAgICAgcmV0dXJuIGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkKVxuICAgICAgICAgICAgICAgIC50aGVuKHZhbGlkUGFzc3dvcmQgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghdmFsaWRQYXNzd29yZCkgdGhyb3cgbmV3IE5vdEFsbG93ZWRFcnJvcihgd3JvbmcgY3JlZGVudGlhbHNgKVxuXG4gICAgICAgICAgICAgICAgICAgIHVzZXIuYXV0aGVudGljYXRlZCA9IG5ldyBEYXRlXG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXIuc2F2ZSgpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbigoeyBpZCB9KSA9PiBpZClcbiAgICAgICAgfSlcbn0iXX0=