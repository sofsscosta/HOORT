function cov_22rza11mjy(){var path="/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/update-item-add.js";var hash="000803b3c6af57383147107022d0ccb38fe36e0b";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/update-item-add.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:43}},"1":{start:{line:2,column:41},end:{line:2,column:62}},"2":{start:{line:3,column:42},end:{line:3,column:71}},"3":{start:{line:5,column:0},end:{line:40,column:1}},"4":{start:{line:6,column:4},end:{line:6,column:37}},"5":{start:{line:7,column:4},end:{line:7,column:37}},"6":{start:{line:8,column:4},end:{line:8,column:37}},"7":{start:{line:10,column:17},end:{line:10,column:44}},"8":{start:{line:12,column:4},end:{line:12,column:62}},"9":{start:{line:12,column:17},end:{line:12,column:62}},"10":{start:{line:14,column:15},end:{line:14,column:49}},"11":{start:{line:16,column:4},end:{line:16,column:60}},"12":{start:{line:16,column:15},end:{line:16,column:60}},"13":{start:{line:18,column:4},end:{line:39,column:5}},"14":{start:{line:20,column:12},end:{line:20,column:45}},"15":{start:{line:23,column:8},end:{line:23,column:37}},"16":{start:{line:24,column:8},end:{line:24,column:23}},"17":{start:{line:25,column:8},end:{line:25,column:23}},"18":{start:{line:27,column:8},end:{line:30,column:10}},"19":{start:{line:28,column:12},end:{line:28,column:43}},"20":{start:{line:29,column:12},end:{line:29,column:28}},"21":{start:{line:32,column:8},end:{line:32,column:14}},"22":{start:{line:36,column:8},end:{line:36,column:95}},"23":{start:{line:38,column:8},end:{line:38,column:14}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:17},end:{line:5,column:18}},loc:{start:{line:5,column:51},end:{line:40,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:19,column:29},end:{line:19,column:30}},loc:{start:{line:20,column:12},end:{line:20,column:45}},line:20},"2":{name:"(anonymous_2)",decl:{start:{line:27,column:32},end:{line:27,column:33}},loc:{start:{line:27,column:41},end:{line:30,column:9}},line:27}},branchMap:{"0":{loc:{start:{line:12,column:4},end:{line:12,column:62}},type:"if",locations:[{start:{line:12,column:4},end:{line:12,column:62}},{start:{line:12,column:4},end:{line:12,column:62}}],line:12},"1":{loc:{start:{line:16,column:4},end:{line:16,column:60}},type:"if",locations:[{start:{line:16,column:4},end:{line:16,column:60}},{start:{line:16,column:4},end:{line:16,column:60}}],line:16},"2":{loc:{start:{line:18,column:4},end:{line:39,column:5}},type:"if",locations:[{start:{line:18,column:4},end:{line:39,column:5}},{start:{line:18,column:4},end:{line:39,column:5}}],line:18}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"000803b3c6af57383147107022d0ccb38fe36e0b"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_22rza11mjy=function(){return actualCoverage;};return actualCoverage;}cov_22rza11mjy();const{validate}=(cov_22rza11mjy().s[0]++,require('hoort-utils'));const{models:{Land,Item,User}}=(cov_22rza11mjy().s[1]++,require('hoort-data'));const{NotAllowedError,ContentError}=(cov_22rza11mjy().s[2]++,require('../../hoort-errors'));cov_22rza11mjy().s[3]++;module.exports=async(userId,landId,itemId)=>{cov_22rza11mjy().f[0]++;cov_22rza11mjy().s[4]++;validate.string(userId,'userId');cov_22rza11mjy().s[5]++;validate.string(landId,'landId');cov_22rza11mjy().s[6]++;validate.string(itemId,'itemId');let veggie=(cov_22rza11mjy().s[7]++,await Item.findById(itemId));cov_22rza11mjy().s[8]++;if(!veggie){cov_22rza11mjy().b[0][0]++;cov_22rza11mjy().s[9]++;throw new ContentError('item does not exist');}else{cov_22rza11mjy().b[0][1]++;}let land=(cov_22rza11mjy().s[10]++,await Land.findById(landId).lean());cov_22rza11mjy().s[11]++;if(!land){cov_22rza11mjy().b[1][0]++;cov_22rza11mjy().s[12]++;throw new ContentError('land does not exist');}else{cov_22rza11mjy().b[1][1]++;}cov_22rza11mjy().s[13]++;if(land.plantation.find(item=>{cov_22rza11mjy().f[1]++;cov_22rza11mjy().s[14]++;return item.veggie.toString()===itemId;})!==undefined){cov_22rza11mjy().b[2][0]++;cov_22rza11mjy().s[15]++;land.id=land._id.toString();cov_22rza11mjy().s[16]++;delete land._id;cov_22rza11mjy().s[17]++;delete land.__v;cov_22rza11mjy().s[18]++;land.plantation.forEach(plant=>{cov_22rza11mjy().f[2]++;cov_22rza11mjy().s[19]++;plant.id=plant._id.toString();cov_22rza11mjy().s[20]++;delete plant._id;});cov_22rza11mjy().s[21]++;return;}else{cov_22rza11mjy().b[2][1]++;cov_22rza11mjy().s[22]++;await Land.findByIdAndUpdate(landId,{$addToSet:{plantation:{veggie:itemId}}});// console.log(updatedLand)
cov_22rza11mjy().s[23]++;return;}};// module.exports = async (userId, landId, itemId) => {
//     validate.string(userId, 'userId')
//     validate.string(landId, 'landId')
//     validate.string(itemId, 'itemId')
//     let _veggie = await Item.findById(itemId)
//     if (!_veggie) throw new ContentError('item does not exist')
//     debugger
//     let land = await Land.findOne({ id: landId, plantation: { $elemMatch: { veggie: itemId } } })
//     if (land) return land
//     else return await Land.findByIdAndUpdate(landId, { $addToSet: { plantation: { veggie: itemId } } })
//     // return
// }
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVwZGF0ZS1pdGVtLWFkZC5qcyJdLCJuYW1lcyI6WyJ2YWxpZGF0ZSIsInJlcXVpcmUiLCJtb2RlbHMiLCJMYW5kIiwiSXRlbSIsIlVzZXIiLCJOb3RBbGxvd2VkRXJyb3IiLCJDb250ZW50RXJyb3IiLCJtb2R1bGUiLCJleHBvcnRzIiwidXNlcklkIiwibGFuZElkIiwiaXRlbUlkIiwic3RyaW5nIiwidmVnZ2llIiwiZmluZEJ5SWQiLCJsYW5kIiwibGVhbiIsInBsYW50YXRpb24iLCJmaW5kIiwiaXRlbSIsInRvU3RyaW5nIiwidW5kZWZpbmVkIiwiaWQiLCJfaWQiLCJfX3YiLCJmb3JFYWNoIiwicGxhbnQiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRhZGRUb1NldCJdLCJtYXBwaW5ncyI6Ijh3R0FBQSxLQUFNLENBQUVBLFFBQUYsMkJBQWVDLE9BQU8sQ0FBQyxhQUFELENBQXRCLENBQU4sQ0FDQSxLQUFNLENBQUVDLE1BQU0sQ0FBRSxDQUFFQyxJQUFGLENBQVFDLElBQVIsQ0FBY0MsSUFBZCxDQUFWLDJCQUFtQ0osT0FBTyxDQUFDLFlBQUQsQ0FBMUMsQ0FBTixDQUNBLEtBQU0sQ0FBRUssZUFBRixDQUFtQkMsWUFBbkIsMkJBQW9DTixPQUFPLENBQUMsb0JBQUQsQ0FBM0MsQ0FBTixDLHdCQUVBTyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsTUFBT0MsTUFBUCxDQUFlQyxNQUFmLENBQXVCQyxNQUF2QixHQUFrQyxpREFDL0NaLFFBQVEsQ0FBQ2EsTUFBVCxDQUFnQkgsTUFBaEIsQ0FBd0IsUUFBeEIsRUFEK0Msd0JBRS9DVixRQUFRLENBQUNhLE1BQVQsQ0FBZ0JGLE1BQWhCLENBQXdCLFFBQXhCLEVBRitDLHdCQUcvQ1gsUUFBUSxDQUFDYSxNQUFULENBQWdCRCxNQUFoQixDQUF3QixRQUF4QixFQUVBLEdBQUlFLENBQUFBLE1BQU0sMEJBQUcsS0FBTVYsQ0FBQUEsSUFBSSxDQUFDVyxRQUFMLENBQWNILE1BQWQsQ0FBVCxDQUFWLENBTCtDLHdCQU8vQyxHQUFJLENBQUNFLE1BQUwsQ0FBYSx5REFBTSxJQUFJUCxDQUFBQSxZQUFKLENBQWlCLHFCQUFqQixDQUFOLENBQTZDLENBQTFELGlDQUVBLEdBQUlTLENBQUFBLElBQUksMkJBQUcsS0FBTWIsQ0FBQUEsSUFBSSxDQUFDWSxRQUFMLENBQWNKLE1BQWQsRUFBc0JNLElBQXRCLEVBQVQsQ0FBUixDQVQrQyx5QkFXL0MsR0FBSSxDQUFDRCxJQUFMLENBQVcsMERBQU0sSUFBSVQsQ0FBQUEsWUFBSixDQUFpQixxQkFBakIsQ0FBTixDQUE2QyxDQUF4RCxpQ0FYK0MseUJBYS9DLEdBQ0lTLElBQUksQ0FBQ0UsVUFBTCxDQUFnQkMsSUFBaEIsQ0FBcUJDLElBQUksRUFDckIsd0RBQUFBLENBQUFBLElBQUksQ0FBQ04sTUFBTCxDQUFZTyxRQUFaLEtBQTJCVCxNQUEzQixDQUFpQyxDQURyQyxJQUVNVSxTQUhWLENBR3FCLHFEQUVqQk4sSUFBSSxDQUFDTyxFQUFMLENBQVVQLElBQUksQ0FBQ1EsR0FBTCxDQUFTSCxRQUFULEVBQVYsQ0FGaUIseUJBR2pCLE1BQU9MLENBQUFBLElBQUksQ0FBQ1EsR0FBWixDQUhpQix5QkFJakIsTUFBT1IsQ0FBQUEsSUFBSSxDQUFDUyxHQUFaLENBSmlCLHlCQU1qQlQsSUFBSSxDQUFDRSxVQUFMLENBQWdCUSxPQUFoQixDQUF3QkMsS0FBSyxFQUFJLGtEQUM3QkEsS0FBSyxDQUFDSixFQUFOLENBQVdJLEtBQUssQ0FBQ0gsR0FBTixDQUFVSCxRQUFWLEVBQVgsQ0FENkIseUJBRTdCLE1BQU9NLENBQUFBLEtBQUssQ0FBQ0gsR0FBYixDQUNILENBSEQsRUFOaUIseUJBV2pCLE9BQ0gsQ0FmRCxJQWlCSyxxREFDRCxLQUFNckIsQ0FBQUEsSUFBSSxDQUFDeUIsaUJBQUwsQ0FBdUJqQixNQUF2QixDQUErQixDQUFFa0IsU0FBUyxDQUFFLENBQUVYLFVBQVUsQ0FBRSxDQUFFSixNQUFNLENBQUVGLE1BQVYsQ0FBZCxDQUFiLENBQS9CLENBQU4sQ0FDQTtBQUZDLHlCQUdELE9BQ0gsQ0FDSixDQW5DRCxDQXFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IHZhbGlkYXRlIH0gPSByZXF1aXJlKCdob29ydC11dGlscycpXG5jb25zdCB7IG1vZGVsczogeyBMYW5kLCBJdGVtLCBVc2VyIH0gfSA9IHJlcXVpcmUoJ2hvb3J0LWRhdGEnKVxuY29uc3QgeyBOb3RBbGxvd2VkRXJyb3IsIENvbnRlbnRFcnJvciB9ID0gcmVxdWlyZSgnLi4vLi4vaG9vcnQtZXJyb3JzJylcblxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAodXNlcklkLCBsYW5kSWQsIGl0ZW1JZCkgPT4ge1xuICAgIHZhbGlkYXRlLnN0cmluZyh1c2VySWQsICd1c2VySWQnKVxuICAgIHZhbGlkYXRlLnN0cmluZyhsYW5kSWQsICdsYW5kSWQnKVxuICAgIHZhbGlkYXRlLnN0cmluZyhpdGVtSWQsICdpdGVtSWQnKVxuXG4gICAgbGV0IHZlZ2dpZSA9IGF3YWl0IEl0ZW0uZmluZEJ5SWQoaXRlbUlkKVxuXG4gICAgaWYgKCF2ZWdnaWUpIHRocm93IG5ldyBDb250ZW50RXJyb3IoJ2l0ZW0gZG9lcyBub3QgZXhpc3QnKVxuXG4gICAgbGV0IGxhbmQgPSBhd2FpdCBMYW5kLmZpbmRCeUlkKGxhbmRJZCkubGVhbigpXG5cbiAgICBpZiAoIWxhbmQpIHRocm93IG5ldyBDb250ZW50RXJyb3IoJ2xhbmQgZG9lcyBub3QgZXhpc3QnKVxuXG4gICAgaWYgKFxuICAgICAgICBsYW5kLnBsYW50YXRpb24uZmluZChpdGVtID0+XG4gICAgICAgICAgICBpdGVtLnZlZ2dpZS50b1N0cmluZygpID09PSBpdGVtSWRcbiAgICAgICAgKSAhPT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgbGFuZC5pZCA9IGxhbmQuX2lkLnRvU3RyaW5nKClcbiAgICAgICAgZGVsZXRlIGxhbmQuX2lkXG4gICAgICAgIGRlbGV0ZSBsYW5kLl9fdlxuXG4gICAgICAgIGxhbmQucGxhbnRhdGlvbi5mb3JFYWNoKHBsYW50ID0+IHtcbiAgICAgICAgICAgIHBsYW50LmlkID0gcGxhbnQuX2lkLnRvU3RyaW5nKClcbiAgICAgICAgICAgIGRlbGV0ZSBwbGFudC5faWRcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBlbHNlIHtcbiAgICAgICAgYXdhaXQgTGFuZC5maW5kQnlJZEFuZFVwZGF0ZShsYW5kSWQsIHsgJGFkZFRvU2V0OiB7IHBsYW50YXRpb246IHsgdmVnZ2llOiBpdGVtSWQgfSB9IH0pXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHVwZGF0ZWRMYW5kKVxuICAgICAgICByZXR1cm5cbiAgICB9XG59XG5cbi8vIG1vZHVsZS5leHBvcnRzID0gYXN5bmMgKHVzZXJJZCwgbGFuZElkLCBpdGVtSWQpID0+IHtcbi8vICAgICB2YWxpZGF0ZS5zdHJpbmcodXNlcklkLCAndXNlcklkJylcbi8vICAgICB2YWxpZGF0ZS5zdHJpbmcobGFuZElkLCAnbGFuZElkJylcbi8vICAgICB2YWxpZGF0ZS5zdHJpbmcoaXRlbUlkLCAnaXRlbUlkJylcbi8vICAgICBsZXQgX3ZlZ2dpZSA9IGF3YWl0IEl0ZW0uZmluZEJ5SWQoaXRlbUlkKVxuXG4vLyAgICAgaWYgKCFfdmVnZ2llKSB0aHJvdyBuZXcgQ29udGVudEVycm9yKCdpdGVtIGRvZXMgbm90IGV4aXN0Jylcbi8vICAgICBkZWJ1Z2dlclxuLy8gICAgIGxldCBsYW5kID0gYXdhaXQgTGFuZC5maW5kT25lKHsgaWQ6IGxhbmRJZCwgcGxhbnRhdGlvbjogeyAkZWxlbU1hdGNoOiB7IHZlZ2dpZTogaXRlbUlkIH0gfSB9KVxuXG4vLyAgICAgaWYgKGxhbmQpIHJldHVybiBsYW5kXG5cbi8vICAgICBlbHNlIHJldHVybiBhd2FpdCBMYW5kLmZpbmRCeUlkQW5kVXBkYXRlKGxhbmRJZCwgeyAkYWRkVG9TZXQ6IHsgcGxhbnRhdGlvbjogeyB2ZWdnaWU6IGl0ZW1JZCB9IH0gfSlcblxuLy8gICAgIC8vIHJldHVyblxuLy8gfSJdfQ==