function cov_cdaz4rmfs(){var path="/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/delete-user.js";var hash="5543e4cc27e840e2c588aaf3f9f163437eef2fee";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/delete-user.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:43}},"1":{start:{line:2,column:35},end:{line:2,column:56}},"2":{start:{line:3,column:28},end:{line:3,column:57}},"3":{start:{line:4,column:15},end:{line:4,column:34}},"4":{start:{line:6,column:0},end:{line:36,column:1}},"5":{start:{line:8,column:4},end:{line:8,column:29}},"6":{start:{line:9,column:4},end:{line:9,column:41}},"7":{start:{line:11,column:20},end:{line:11,column:22}},"8":{start:{line:13,column:4},end:{line:35,column:10}},"9":{start:{line:15,column:12},end:{line:15,column:69}},"10":{start:{line:15,column:23},end:{line:15,column:69}},"11":{start:{line:17,column:12},end:{line:34,column:32}},"12":{start:{line:20,column:20},end:{line:20,column:86}},"13":{start:{line:20,column:40},end:{line:20,column:86}},"14":{start:{line:22,column:20},end:{line:22,column:68}},"15":{start:{line:22,column:47},end:{line:22,column:67}},"16":{start:{line:24,column:20},end:{line:24,column:49}},"17":{start:{line:26,column:20},end:{line:26,column:53}},"18":{start:{line:29,column:20},end:{line:32,column:22}},"19":{start:{line:31,column:24},end:{line:31,column:59}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:17},end:{line:6,column:18}},loc:{start:{line:6,column:35},end:{line:36,column:1}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:14},end:{line:14,column:15}},loc:{start:{line:14,column:22},end:{line:35,column:9}},line:14},"2":{name:"(anonymous_2)",decl:{start:{line:18,column:22},end:{line:18,column:23}},loc:{start:{line:18,column:39},end:{line:27,column:17}},line:18},"3":{name:"(anonymous_3)",decl:{start:{line:22,column:39},end:{line:22,column:40}},loc:{start:{line:22,column:47},end:{line:22,column:67}},line:22},"4":{name:"(anonymous_4)",decl:{start:{line:28,column:22},end:{line:28,column:23}},loc:{start:{line:28,column:28},end:{line:33,column:17}},line:28},"5":{name:"(anonymous_5)",decl:{start:{line:29,column:38},end:{line:29,column:39}},loc:{start:{line:29,column:53},end:{line:32,column:21}},line:29},"6":{name:"(anonymous_6)",decl:{start:{line:34,column:22},end:{line:34,column:23}},loc:{start:{line:34,column:28},end:{line:34,column:31}},line:34}},branchMap:{"0":{loc:{start:{line:15,column:12},end:{line:15,column:69}},type:"if",locations:[{start:{line:15,column:12},end:{line:15,column:69}},{start:{line:15,column:12},end:{line:15,column:69}}],line:15},"1":{loc:{start:{line:20,column:20},end:{line:20,column:86}},type:"if",locations:[{start:{line:20,column:20},end:{line:20,column:86}},{start:{line:20,column:20},end:{line:20,column:86}}],line:20}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"5543e4cc27e840e2c588aaf3f9f163437eef2fee"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_cdaz4rmfs=function(){return actualCoverage;};return actualCoverage;}cov_cdaz4rmfs();const{validate}=(cov_cdaz4rmfs().s[0]++,require('hoort-utils'));const{models:{User,Land}}=(cov_cdaz4rmfs().s[1]++,require('hoort-data'));const{NotAllowedError}=(cov_cdaz4rmfs().s[2]++,require('../../hoort-errors'));const bcrypt=(cov_cdaz4rmfs().s[3]++,require('bcryptjs'));cov_cdaz4rmfs().s[4]++;module.exports=(id,password)=>{cov_cdaz4rmfs().f[0]++;cov_cdaz4rmfs().s[5]++;validate.string(id,'id');cov_cdaz4rmfs().s[6]++;validate.string(password,'password');let userLands=(cov_cdaz4rmfs().s[7]++,[]);cov_cdaz4rmfs().s[8]++;return User.findById(id).then(user=>{cov_cdaz4rmfs().f[1]++;cov_cdaz4rmfs().s[9]++;if(!user){cov_cdaz4rmfs().b[0][0]++;cov_cdaz4rmfs().s[10]++;throw new NotAllowedError(`wrong credentials`);}else{cov_cdaz4rmfs().b[0][1]++;}cov_cdaz4rmfs().s[11]++;return bcrypt.compare(password,user.password).then(validPassword=>{cov_cdaz4rmfs().f[2]++;cov_cdaz4rmfs().s[12]++;if(!validPassword){cov_cdaz4rmfs().b[1][0]++;cov_cdaz4rmfs().s[13]++;throw new NotAllowedError(`wrong credentials`);}else{cov_cdaz4rmfs().b[1][1]++;}cov_cdaz4rmfs().s[14]++;user.lands.forEach(land=>{cov_cdaz4rmfs().f[3]++;cov_cdaz4rmfs().s[15]++;return userLands.push(land);});cov_cdaz4rmfs().s[16]++;user.authenticated=new Date();cov_cdaz4rmfs().s[17]++;return User.findByIdAndDelete(id);}).then(()=>{cov_cdaz4rmfs().f[4]++;cov_cdaz4rmfs().s[18]++;userLands.forEach(async _land=>{cov_cdaz4rmfs().f[5]++;cov_cdaz4rmfs().s[19]++;await Land.findByIdAndDelete(_land);});}).then(()=>{cov_cdaz4rmfs().f[6]++;});});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlbGV0ZS11c2VyLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicmVxdWlyZSIsIm1vZGVscyIsIlVzZXIiLCJMYW5kIiwiTm90QWxsb3dlZEVycm9yIiwiYmNyeXB0IiwibW9kdWxlIiwiZXhwb3J0cyIsImlkIiwicGFzc3dvcmQiLCJzdHJpbmciLCJ1c2VyTGFuZHMiLCJmaW5kQnlJZCIsInRoZW4iLCJ1c2VyIiwiY29tcGFyZSIsInZhbGlkUGFzc3dvcmQiLCJsYW5kcyIsImZvckVhY2giLCJsYW5kIiwicHVzaCIsImF1dGhlbnRpY2F0ZWQiLCJEYXRlIiwiZmluZEJ5SWRBbmREZWxldGUiLCJfbGFuZCJdLCJtYXBwaW5ncyI6Im83R0FBQSxLQUFNLENBQUVBLFFBQUYsMEJBQWVDLE9BQU8sQ0FBQyxhQUFELENBQXRCLENBQU4sQ0FDQSxLQUFNLENBQUVDLE1BQU0sQ0FBRSxDQUFFQyxJQUFGLENBQVFDLElBQVIsQ0FBViwwQkFBNkJILE9BQU8sQ0FBQyxZQUFELENBQXBDLENBQU4sQ0FDQSxLQUFNLENBQUVJLGVBQUYsMEJBQXNCSixPQUFPLENBQUMsb0JBQUQsQ0FBN0IsQ0FBTixDQUNBLEtBQU1LLENBQUFBLE1BQU0seUJBQUdMLE9BQU8sQ0FBQyxVQUFELENBQVYsQ0FBWixDLHVCQUVBTSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBQ0MsRUFBRCxDQUFLQyxRQUFMLEdBQWtCLCtDQUUvQlYsUUFBUSxDQUFDVyxNQUFULENBQWdCRixFQUFoQixDQUFvQixJQUFwQixFQUYrQix1QkFHL0JULFFBQVEsQ0FBQ1csTUFBVCxDQUFnQkQsUUFBaEIsQ0FBMEIsVUFBMUIsRUFFQSxHQUFJRSxDQUFBQSxTQUFTLHlCQUFHLEVBQUgsQ0FBYixDQUwrQix1QkFPL0IsTUFBT1QsQ0FBQUEsSUFBSSxDQUFDVSxRQUFMLENBQWNKLEVBQWQsRUFDRkssSUFERSxDQUNHQyxJQUFJLEVBQUksK0NBQ1YsR0FBSSxDQUFDQSxJQUFMLENBQVcsd0RBQU0sSUFBSVYsQ0FBQUEsZUFBSixDQUFxQixtQkFBckIsQ0FBTixDQUE4QyxDQUF6RCxnQ0FEVSx3QkFHVixNQUFPQyxDQUFBQSxNQUFNLENBQUNVLE9BQVAsQ0FBZU4sUUFBZixDQUF5QkssSUFBSSxDQUFDTCxRQUE5QixFQUNGSSxJQURFLENBQ0dHLGFBQWEsRUFBSSxnREFFbkIsR0FBSSxDQUFDQSxhQUFMLENBQW9CLHdEQUFNLElBQUlaLENBQUFBLGVBQUosQ0FBcUIsbUJBQXJCLENBQU4sQ0FBOEMsQ0FBbEUsZ0NBRm1CLHdCQUluQlUsSUFBSSxDQUFDRyxLQUFMLENBQVdDLE9BQVgsQ0FBbUJDLElBQUksRUFBSSxzREFBQVIsQ0FBQUEsU0FBUyxDQUFDUyxJQUFWLENBQWVELElBQWYsRUFBb0IsQ0FBL0MsRUFKbUIsd0JBTW5CTCxJQUFJLENBQUNPLGFBQUwsQ0FBcUIsR0FBSUMsQ0FBQUEsSUFBSixFQUFyQixDQU5tQix3QkFRbkIsTUFBT3BCLENBQUFBLElBQUksQ0FBQ3FCLGlCQUFMLENBQXVCZixFQUF2QixDQUFQLENBQ0gsQ0FWRSxFQVdGSyxJQVhFLENBV0csSUFBTSxnREFDUkYsU0FBUyxDQUFDTyxPQUFWLENBQWtCLEtBQU1NLENBQUFBLEtBQU4sRUFBZSxnREFFN0IsS0FBTXJCLENBQUFBLElBQUksQ0FBQ29CLGlCQUFMLENBQXVCQyxLQUF2QixDQUFOLENBQ0gsQ0FIRCxFQUlILENBaEJFLEVBaUJGWCxJQWpCRSxDQWlCRyxJQUFNLHdCQUFHLENBakJaLENBQVAsQ0FrQkgsQ0F0QkUsQ0FBUCxDQXVCSCxDQTlCRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgdmFsaWRhdGUgfSA9IHJlcXVpcmUoJ2hvb3J0LXV0aWxzJylcbmNvbnN0IHsgbW9kZWxzOiB7IFVzZXIsIExhbmQgfSB9ID0gcmVxdWlyZSgnaG9vcnQtZGF0YScpXG5jb25zdCB7IE5vdEFsbG93ZWRFcnJvciB9ID0gcmVxdWlyZSgnLi4vLi4vaG9vcnQtZXJyb3JzJylcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcblxubW9kdWxlLmV4cG9ydHMgPSAoaWQsIHBhc3N3b3JkKSA9PiB7XG5cbiAgICB2YWxpZGF0ZS5zdHJpbmcoaWQsICdpZCcpXG4gICAgdmFsaWRhdGUuc3RyaW5nKHBhc3N3b3JkLCAncGFzc3dvcmQnKVxuXG4gICAgbGV0IHVzZXJMYW5kcyA9IFtdXG5cbiAgICByZXR1cm4gVXNlci5maW5kQnlJZChpZClcbiAgICAgICAgLnRoZW4odXNlciA9PiB7XG4gICAgICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBOb3RBbGxvd2VkRXJyb3IoYHdyb25nIGNyZWRlbnRpYWxzYClcblxuICAgICAgICAgICAgcmV0dXJuIGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkKVxuICAgICAgICAgICAgICAgIC50aGVuKHZhbGlkUGFzc3dvcmQgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghdmFsaWRQYXNzd29yZCkgdGhyb3cgbmV3IE5vdEFsbG93ZWRFcnJvcihgd3JvbmcgY3JlZGVudGlhbHNgKVxuXG4gICAgICAgICAgICAgICAgICAgIHVzZXIubGFuZHMuZm9yRWFjaChsYW5kID0+IHVzZXJMYW5kcy5wdXNoKGxhbmQpKVxuXG4gICAgICAgICAgICAgICAgICAgIHVzZXIuYXV0aGVudGljYXRlZCA9IG5ldyBEYXRlXG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFVzZXIuZmluZEJ5SWRBbmREZWxldGUoaWQpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJMYW5kcy5mb3JFYWNoKGFzeW5jIF9sYW5kID0+IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgTGFuZC5maW5kQnlJZEFuZERlbGV0ZShfbGFuZClcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsgfSlcbiAgICAgICAgfSlcbn0iXX0=