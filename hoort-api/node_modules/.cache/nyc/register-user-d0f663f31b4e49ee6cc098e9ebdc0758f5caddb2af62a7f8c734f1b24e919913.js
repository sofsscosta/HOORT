function cov_16g6gtwyrv(){var path="/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/register-user.js";var hash="70f1ae3c8bea9cb7be90107bbd11d49726a52cb5";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/register-user.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:43}},"1":{start:{line:2,column:29},end:{line:2,column:50}},"2":{start:{line:3,column:28},end:{line:3,column:57}},"3":{start:{line:4,column:15},end:{line:4,column:34}},"4":{start:{line:6,column:0},end:{line:25,column:1}},"5":{start:{line:8,column:4},end:{line:8,column:33}},"6":{start:{line:9,column:4},end:{line:9,column:41}},"7":{start:{line:10,column:4},end:{line:10,column:25}},"8":{start:{line:11,column:4},end:{line:11,column:41}},"9":{start:{line:13,column:4},end:{line:24,column:24}},"10":{start:{line:15,column:12},end:{line:15,column:90}},"11":{start:{line:15,column:22},end:{line:15,column:90}},"12":{start:{line:17,column:12},end:{line:17,column:44}},"13":{start:{line:20,column:12},end:{line:20,column:83}},"14":{start:{line:22,column:12},end:{line:22,column:30}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:17},end:{line:6,column:18}},loc:{start:{line:6,column:54},end:{line:25,column:1}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:14},end:{line:14,column:15}},loc:{start:{line:14,column:22},end:{line:18,column:9}},line:14},"2":{name:"(anonymous_2)",decl:{start:{line:19,column:14},end:{line:19,column:15}},loc:{start:{line:19,column:26},end:{line:23,column:9}},line:19},"3":{name:"(anonymous_3)",decl:{start:{line:24,column:14},end:{line:24,column:15}},loc:{start:{line:24,column:20},end:{line:24,column:23}},line:24}},branchMap:{"0":{loc:{start:{line:15,column:12},end:{line:15,column:90}},type:"if",locations:[{start:{line:15,column:12},end:{line:15,column:90}},{start:{line:15,column:12},end:{line:15,column:90}}],line:15}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"70f1ae3c8bea9cb7be90107bbd11d49726a52cb5"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_16g6gtwyrv=function(){return actualCoverage;};return actualCoverage;}cov_16g6gtwyrv();const{validate}=(cov_16g6gtwyrv().s[0]++,require('hoort-utils'));const{models:{User}}=(cov_16g6gtwyrv().s[1]++,require('hoort-data'));const{NotAllowedError}=(cov_16g6gtwyrv().s[2]++,require('../../hoort-errors'));const bcrypt=(cov_16g6gtwyrv().s[3]++,require('bcryptjs'));cov_16g6gtwyrv().s[4]++;module.exports=(name,username,email,password)=>{cov_16g6gtwyrv().f[0]++;cov_16g6gtwyrv().s[5]++;validate.string(name,'name');cov_16g6gtwyrv().s[6]++;validate.string(username,'username');cov_16g6gtwyrv().s[7]++;validate.email(email);cov_16g6gtwyrv().s[8]++;validate.string(password,'password');cov_16g6gtwyrv().s[9]++;return User.findOne({email}).then(user=>{cov_16g6gtwyrv().f[1]++;cov_16g6gtwyrv().s[10]++;if(user){cov_16g6gtwyrv().b[0][0]++;cov_16g6gtwyrv().s[11]++;throw new NotAllowedError(`user with email ${email} already exists`);}else{cov_16g6gtwyrv().b[0][1]++;}cov_16g6gtwyrv().s[12]++;return bcrypt.hash(password,10);}).then(password=>{cov_16g6gtwyrv().f[2]++;cov_16g6gtwyrv().s[13]++;user=new User({name,username,email,password,created:new Date()});cov_16g6gtwyrv().s[14]++;return user.save();}).then(()=>{cov_16g6gtwyrv().f[3]++;});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZ2lzdGVyLXVzZXIuanMiXSwibmFtZXMiOlsidmFsaWRhdGUiLCJyZXF1aXJlIiwibW9kZWxzIiwiVXNlciIsIk5vdEFsbG93ZWRFcnJvciIsImJjcnlwdCIsIm1vZHVsZSIsImV4cG9ydHMiLCJuYW1lIiwidXNlcm5hbWUiLCJlbWFpbCIsInBhc3N3b3JkIiwic3RyaW5nIiwiZmluZE9uZSIsInRoZW4iLCJ1c2VyIiwiaGFzaCIsImNyZWF0ZWQiLCJEYXRlIiwic2F2ZSJdLCJtYXBwaW5ncyI6IjQ5RUFBQSxLQUFNLENBQUVBLFFBQUYsMkJBQWVDLE9BQU8sQ0FBQyxhQUFELENBQXRCLENBQU4sQ0FDQSxLQUFNLENBQUVDLE1BQU0sQ0FBRSxDQUFFQyxJQUFGLENBQVYsMkJBQXVCRixPQUFPLENBQUMsWUFBRCxDQUE5QixDQUFOLENBQ0EsS0FBTSxDQUFFRyxlQUFGLDJCQUFzQkgsT0FBTyxDQUFDLG9CQUFELENBQTdCLENBQU4sQ0FDQSxLQUFNSSxDQUFBQSxNQUFNLDBCQUFHSixPQUFPLENBQUMsVUFBRCxDQUFWLENBQVosQyx3QkFFQUssTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQUNDLElBQUQsQ0FBT0MsUUFBUCxDQUFpQkMsS0FBakIsQ0FBd0JDLFFBQXhCLEdBQXFDLGlEQUVsRFgsUUFBUSxDQUFDWSxNQUFULENBQWdCSixJQUFoQixDQUFzQixNQUF0QixFQUZrRCx3QkFHbERSLFFBQVEsQ0FBQ1ksTUFBVCxDQUFnQkgsUUFBaEIsQ0FBMEIsVUFBMUIsRUFIa0Qsd0JBSWxEVCxRQUFRLENBQUNVLEtBQVQsQ0FBZUEsS0FBZixFQUprRCx3QkFLbERWLFFBQVEsQ0FBQ1ksTUFBVCxDQUFnQkQsUUFBaEIsQ0FBMEIsVUFBMUIsRUFMa0Qsd0JBT2xELE1BQU9SLENBQUFBLElBQUksQ0FBQ1UsT0FBTCxDQUFhLENBQUVILEtBQUYsQ0FBYixFQUNGSSxJQURFLENBQ0dDLElBQUksRUFBSSxrREFDVixHQUFJQSxJQUFKLENBQVUsMERBQU0sSUFBSVgsQ0FBQUEsZUFBSixDQUFxQixtQkFBa0JNLEtBQU0saUJBQTdDLENBQU4sQ0FBb0UsQ0FBOUUsaUNBRFUseUJBR1YsTUFBT0wsQ0FBQUEsTUFBTSxDQUFDVyxJQUFQLENBQVlMLFFBQVosQ0FBc0IsRUFBdEIsQ0FBUCxDQUNILENBTEUsRUFNRkcsSUFORSxDQU1HSCxRQUFRLEVBQUksa0RBQ2RJLElBQUksQ0FBRyxHQUFJWixDQUFBQSxJQUFKLENBQVMsQ0FBRUssSUFBRixDQUFRQyxRQUFSLENBQWtCQyxLQUFsQixDQUF5QkMsUUFBekIsQ0FBbUNNLE9BQU8sQ0FBRSxHQUFJQyxDQUFBQSxJQUFKLEVBQTVDLENBQVQsQ0FBUCxDQURjLHlCQUdkLE1BQU9ILENBQUFBLElBQUksQ0FBQ0ksSUFBTCxFQUFQLENBQ0gsQ0FWRSxFQVdGTCxJQVhFLENBV0csSUFBTSx5QkFBRyxDQVhaLENBQVAsQ0FZSCxDQW5CRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgdmFsaWRhdGUgfSA9IHJlcXVpcmUoJ2hvb3J0LXV0aWxzJylcbmNvbnN0IHsgbW9kZWxzOiB7IFVzZXIgfSB9ID0gcmVxdWlyZSgnaG9vcnQtZGF0YScpXG5jb25zdCB7IE5vdEFsbG93ZWRFcnJvciB9ID0gcmVxdWlyZSgnLi4vLi4vaG9vcnQtZXJyb3JzJylcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcblxubW9kdWxlLmV4cG9ydHMgPSAobmFtZSwgdXNlcm5hbWUsIGVtYWlsLCBwYXNzd29yZCkgPT4ge1xuXG4gICAgdmFsaWRhdGUuc3RyaW5nKG5hbWUsICduYW1lJylcbiAgICB2YWxpZGF0ZS5zdHJpbmcodXNlcm5hbWUsICd1c2VybmFtZScpXG4gICAgdmFsaWRhdGUuZW1haWwoZW1haWwpXG4gICAgdmFsaWRhdGUuc3RyaW5nKHBhc3N3b3JkLCAncGFzc3dvcmQnKVxuXG4gICAgcmV0dXJuIFVzZXIuZmluZE9uZSh7IGVtYWlsIH0pXG4gICAgICAgIC50aGVuKHVzZXIgPT4ge1xuICAgICAgICAgICAgaWYgKHVzZXIpIHRocm93IG5ldyBOb3RBbGxvd2VkRXJyb3IoYHVzZXIgd2l0aCBlbWFpbCAke2VtYWlsfSBhbHJlYWR5IGV4aXN0c2ApXG5cbiAgICAgICAgICAgIHJldHVybiBiY3J5cHQuaGFzaChwYXNzd29yZCwgMTApXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKHBhc3N3b3JkID0+IHtcbiAgICAgICAgICAgIHVzZXIgPSBuZXcgVXNlcih7IG5hbWUsIHVzZXJuYW1lLCBlbWFpbCwgcGFzc3dvcmQsIGNyZWF0ZWQ6IG5ldyBEYXRlIH0pXG5cbiAgICAgICAgICAgIHJldHVybiB1c2VyLnNhdmUoKVxuICAgICAgICB9KVxuICAgICAgICAudGhlbigoKSA9PiB7IH0pXG59Il19