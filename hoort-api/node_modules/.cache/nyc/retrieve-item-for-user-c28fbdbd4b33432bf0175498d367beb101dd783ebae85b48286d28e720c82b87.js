function cov_1w4yco4b8y(){var path="/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/retrieve-item-for-user.js";var hash="872173df2fea5682940eceb044f54abf91b69968";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/So/bootcamp/collab/skylab-bootcamp-202001/staff/sofia-costa/hoort/hoort-api/logic/retrieve-item-for-user.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:43}},"1":{start:{line:2,column:35},end:{line:2,column:56}},"2":{start:{line:3,column:26},end:{line:3,column:55}},"3":{start:{line:5,column:0},end:{line:39,column:1}},"4":{start:{line:6,column:4},end:{line:6,column:37}},"5":{start:{line:7,column:4},end:{line:7,column:37}},"6":{start:{line:11,column:15},end:{line:11,column:42}},"7":{start:{line:17,column:28},end:{line:17,column:97}},"8":{start:{line:19,column:16},end:{line:19,column:98}},"9":{start:{line:21,column:4},end:{line:21,column:78}},"10":{start:{line:21,column:16},end:{line:21,column:78}},"11":{start:{line:23,column:20},end:{line:23,column:22}},"12":{start:{line:25,column:4},end:{line:36,column:6}},"13":{start:{line:27,column:21},end:{line:27,column:86}},"14":{start:{line:27,column:51},end:{line:27,column:85}},"15":{start:{line:28,column:8},end:{line:31,column:9}},"16":{start:{line:29,column:12},end:{line:29,column:26}},"17":{start:{line:30,column:12},end:{line:30,column:30}},"18":{start:{line:33,column:8},end:{line:33,column:112}},"19":{start:{line:33,column:24},end:{line:33,column:112}},"20":{start:{line:35,column:8},end:{line:35,column:32}},"21":{start:{line:38,column:4},end:{line:38,column:90}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:17},end:{line:5,column:18}},loc:{start:{line:5,column:43},end:{line:39,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:25,column:18},end:{line:25,column:19}},loc:{start:{line:25,column:26},end:{line:36,column:5}},line:25},"2":{name:"(anonymous_2)",decl:{start:{line:27,column:42},end:{line:27,column:43}},loc:{start:{line:27,column:51},end:{line:27,column:85}},line:27}},branchMap:{"0":{loc:{start:{line:17,column:28},end:{line:17,column:97}},type:"cond-expr",locations:[{start:{line:17,column:53},end:{line:17,column:75}},{start:{line:17,column:78},end:{line:17,column:97}}],line:17},"1":{loc:{start:{line:21,column:4},end:{line:21,column:78}},type:"if",locations:[{start:{line:21,column:4},end:{line:21,column:78}},{start:{line:21,column:4},end:{line:21,column:78}}],line:21},"2":{loc:{start:{line:28,column:8},end:{line:31,column:9}},type:"if",locations:[{start:{line:28,column:8},end:{line:31,column:9}},{start:{line:28,column:8},end:{line:31,column:9}}],line:28},"3":{loc:{start:{line:28,column:12},end:{line:28,column:36}},type:"binary-expr",locations:[{start:{line:28,column:12},end:{line:28,column:21}},{start:{line:28,column:25},end:{line:28,column:36}}],line:28},"4":{loc:{start:{line:33,column:8},end:{line:33,column:112}},type:"if",locations:[{start:{line:33,column:8},end:{line:33,column:112}},{start:{line:33,column:8},end:{line:33,column:112}}],line:33},"5":{loc:{start:{line:33,column:12},end:{line:33,column:22}},type:"binary-expr",locations:[{start:{line:33,column:12},end:{line:33,column:14}},{start:{line:33,column:18},end:{line:33,column:22}}],line:33}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"872173df2fea5682940eceb044f54abf91b69968"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1w4yco4b8y=function(){return actualCoverage;};return actualCoverage;}cov_1w4yco4b8y();const{validate}=(cov_1w4yco4b8y().s[0]++,require('hoort-utils'));const{models:{Item,Land}}=(cov_1w4yco4b8y().s[1]++,require('hoort-data'));const{NotFoundError}=(cov_1w4yco4b8y().s[2]++,require('../../hoort-errors'));cov_1w4yco4b8y().s[3]++;module.exports=async(userId,itemId)=>{cov_1w4yco4b8y().f[0]++;cov_1w4yco4b8y().s[4]++;validate.string(userId,'userId');cov_1w4yco4b8y().s[5]++;validate.string(itemId,'itemId');let to,from,growthDurationUser;let item=(cov_1w4yco4b8y().s[6]++,await Item.findById(itemId));// if (!item) return new NotFoundError(`item with id ${itemId} does not exist`)
//let growthDuration = item.growthDuration
let growthDurationAll=(cov_1w4yco4b8y().s[7]++,item.growthDurationAll?(cov_1w4yco4b8y().b[0][0]++,item.growthDurationAll):(cov_1w4yco4b8y().b[0][1]++,item.growthDuration));let lands=(cov_1w4yco4b8y().s[8]++,await Land.find({userId,plantation:{$elemMatch:{veggie:itemId}}}).lean());cov_1w4yco4b8y().s[9]++;if(!lands){cov_1w4yco4b8y().b[1][0]++;cov_1w4yco4b8y().s[10]++;throw new Error('this veggie is not on any land of this user');}else{cov_1w4yco4b8y().b[1][1]++;}let userLands=(cov_1w4yco4b8y().s[11]++,[]);cov_1w4yco4b8y().s[12]++;lands.forEach(land=>{cov_1w4yco4b8y().f[1]++;let veggie=(cov_1w4yco4b8y().s[13]++,land.plantation.find(plant=>{cov_1w4yco4b8y().f[2]++;cov_1w4yco4b8y().s[14]++;return plant.veggie.toString()===itemId;}));cov_1w4yco4b8y().s[15]++;if((cov_1w4yco4b8y().b[3][0]++,veggie.to)&&(cov_1w4yco4b8y().b[3][1]++,veggie.from)){cov_1w4yco4b8y().b[2][0]++;cov_1w4yco4b8y().s[16]++;to=veggie.to;cov_1w4yco4b8y().s[17]++;from=veggie.from;}else{cov_1w4yco4b8y().b[2][1]++;}cov_1w4yco4b8y().s[18]++;if((cov_1w4yco4b8y().b[5][0]++,to)&&(cov_1w4yco4b8y().b[5][1]++,from)){cov_1w4yco4b8y().b[4][0]++;cov_1w4yco4b8y().s[19]++;growthDurationUser=Math.floor((to.getTime()-from.getTime())/(1000*60*60*24));}else{cov_1w4yco4b8y().b[4][1]++;}cov_1w4yco4b8y().s[20]++;userLands.push(land._id);});cov_1w4yco4b8y().s[21]++;return{lands:userLands,/*growthDuration,*/growthDurationAll,growthDurationUser};};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJldHJpZXZlLWl0ZW0tZm9yLXVzZXIuanMiXSwibmFtZXMiOlsidmFsaWRhdGUiLCJyZXF1aXJlIiwibW9kZWxzIiwiSXRlbSIsIkxhbmQiLCJOb3RGb3VuZEVycm9yIiwibW9kdWxlIiwiZXhwb3J0cyIsInVzZXJJZCIsIml0ZW1JZCIsInN0cmluZyIsInRvIiwiZnJvbSIsImdyb3d0aER1cmF0aW9uVXNlciIsIml0ZW0iLCJmaW5kQnlJZCIsImdyb3d0aER1cmF0aW9uQWxsIiwiZ3Jvd3RoRHVyYXRpb24iLCJsYW5kcyIsImZpbmQiLCJwbGFudGF0aW9uIiwiJGVsZW1NYXRjaCIsInZlZ2dpZSIsImxlYW4iLCJFcnJvciIsInVzZXJMYW5kcyIsImZvckVhY2giLCJsYW5kIiwicGxhbnQiLCJ0b1N0cmluZyIsIk1hdGgiLCJmbG9vciIsImdldFRpbWUiLCJwdXNoIiwiX2lkIl0sIm1hcHBpbmdzIjoiMHlIQUFBLEtBQU0sQ0FBRUEsUUFBRiwyQkFBZUMsT0FBTyxDQUFDLGFBQUQsQ0FBdEIsQ0FBTixDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLElBQUYsQ0FBUUMsSUFBUixDQUFWLDJCQUE2QkgsT0FBTyxDQUFDLFlBQUQsQ0FBcEMsQ0FBTixDQUNBLEtBQU0sQ0FBRUksYUFBRiwyQkFBb0JKLE9BQU8sQ0FBQyxvQkFBRCxDQUEzQixDQUFOLEMsd0JBRUFLLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixNQUFPQyxNQUFQLENBQWVDLE1BQWYsR0FBMEIsaURBQ3ZDVCxRQUFRLENBQUNVLE1BQVQsQ0FBZ0JGLE1BQWhCLENBQXdCLFFBQXhCLEVBRHVDLHdCQUV2Q1IsUUFBUSxDQUFDVSxNQUFULENBQWdCRCxNQUFoQixDQUF3QixRQUF4QixFQUVBLEdBQUlFLENBQUFBLEVBQUosQ0FBUUMsSUFBUixDQUFjQyxrQkFBZCxDQUVBLEdBQUlDLENBQUFBLElBQUksMEJBQUcsS0FBTVgsQ0FBQUEsSUFBSSxDQUFDWSxRQUFMLENBQWNOLE1BQWQsQ0FBVCxDQUFSLENBRUE7QUFFQTtBQUVBLEdBQUlPLENBQUFBLGlCQUFpQiwwQkFBR0YsSUFBSSxDQUFDRSxpQkFBTCw2QkFBeUJGLElBQUksQ0FBQ0UsaUJBQTlCLDhCQUFrREYsSUFBSSxDQUFDRyxjQUF2RCxDQUFILENBQXJCLENBRUEsR0FBSUMsQ0FBQUEsS0FBSywwQkFBRyxLQUFNZCxDQUFBQSxJQUFJLENBQUNlLElBQUwsQ0FBVSxDQUFFWCxNQUFGLENBQVVZLFVBQVUsQ0FBRSxDQUFFQyxVQUFVLENBQUUsQ0FBRUMsTUFBTSxDQUFFYixNQUFWLENBQWQsQ0FBdEIsQ0FBVixFQUFzRWMsSUFBdEUsRUFBVCxDQUFULENBZHVDLHdCQWdCdkMsR0FBSSxDQUFDTCxLQUFMLENBQVksMERBQU0sSUFBSU0sQ0FBQUEsS0FBSixDQUFVLDZDQUFWLENBQU4sQ0FBOEQsQ0FBMUUsaUNBRUEsR0FBSUMsQ0FBQUEsU0FBUywyQkFBRyxFQUFILENBQWIsQ0FsQnVDLHlCQW9CdkNQLEtBQUssQ0FBQ1EsT0FBTixDQUFjQyxJQUFJLEVBQUkseUJBRWxCLEdBQUlMLENBQUFBLE1BQU0sMkJBQUdLLElBQUksQ0FBQ1AsVUFBTCxDQUFnQkQsSUFBaEIsQ0FBcUJTLEtBQUssRUFBSSx3REFBQUEsQ0FBQUEsS0FBSyxDQUFDTixNQUFOLENBQWFPLFFBQWIsS0FBNEJwQixNQUE1QixDQUFrQyxDQUFoRSxDQUFILENBQVYsQ0FGa0IseUJBR2xCLEdBQUksNEJBQUFhLE1BQU0sQ0FBQ1gsRUFBUCwrQkFBYVcsTUFBTSxDQUFDVixJQUFwQixDQUFKLENBQThCLHFEQUMxQkQsRUFBRSxDQUFHVyxNQUFNLENBQUNYLEVBQVosQ0FEMEIseUJBRTFCQyxJQUFJLENBQUdVLE1BQU0sQ0FBQ1YsSUFBZCxDQUNILENBSEQsaUNBSGtCLHlCQVFsQixHQUFJLDRCQUFBRCxFQUFFLCtCQUFJQyxJQUFKLENBQU4sQ0FBZ0IscURBQUFDLGtCQUFrQixDQUFHaUIsSUFBSSxDQUFDQyxLQUFMLENBQVcsQ0FBQ3BCLEVBQUUsQ0FBQ3FCLE9BQUgsR0FBZXBCLElBQUksQ0FBQ29CLE9BQUwsRUFBaEIsR0FBbUMsS0FBTyxFQUFQLENBQVksRUFBWixDQUFpQixFQUFwRCxDQUFYLENBQXJCLENBQXdGLENBQXhHLGlDQVJrQix5QkFVbEJQLFNBQVMsQ0FBQ1EsSUFBVixDQUFlTixJQUFJLENBQUNPLEdBQXBCLEVBQ0gsQ0FYRCxFQXBCdUMseUJBaUN2QyxNQUFPLENBQUVoQixLQUFLLENBQUVPLFNBQVQsQ0FBb0IsbUJBQW9CVCxpQkFBeEMsQ0FBMkRILGtCQUEzRCxDQUFQLENBQ0gsQ0FsQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IHZhbGlkYXRlIH0gPSByZXF1aXJlKCdob29ydC11dGlscycpXG5jb25zdCB7IG1vZGVsczogeyBJdGVtLCBMYW5kIH0gfSA9IHJlcXVpcmUoJ2hvb3J0LWRhdGEnKVxuY29uc3QgeyBOb3RGb3VuZEVycm9yIH0gPSByZXF1aXJlKCcuLi8uLi9ob29ydC1lcnJvcnMnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jICh1c2VySWQsIGl0ZW1JZCkgPT4ge1xuICAgIHZhbGlkYXRlLnN0cmluZyh1c2VySWQsICd1c2VySWQnKVxuICAgIHZhbGlkYXRlLnN0cmluZyhpdGVtSWQsICdpdGVtSWQnKVxuXG4gICAgbGV0IHRvLCBmcm9tLCBncm93dGhEdXJhdGlvblVzZXJcblxuICAgIGxldCBpdGVtID0gYXdhaXQgSXRlbS5maW5kQnlJZChpdGVtSWQpXG5cbiAgICAvLyBpZiAoIWl0ZW0pIHJldHVybiBuZXcgTm90Rm91bmRFcnJvcihgaXRlbSB3aXRoIGlkICR7aXRlbUlkfSBkb2VzIG5vdCBleGlzdGApXG5cbiAgICAvL2xldCBncm93dGhEdXJhdGlvbiA9IGl0ZW0uZ3Jvd3RoRHVyYXRpb25cblxuICAgIGxldCBncm93dGhEdXJhdGlvbkFsbCA9IGl0ZW0uZ3Jvd3RoRHVyYXRpb25BbGwgPyBpdGVtLmdyb3d0aER1cmF0aW9uQWxsIDogaXRlbS5ncm93dGhEdXJhdGlvblxuXG4gICAgbGV0IGxhbmRzID0gYXdhaXQgTGFuZC5maW5kKHsgdXNlcklkLCBwbGFudGF0aW9uOiB7ICRlbGVtTWF0Y2g6IHsgdmVnZ2llOiBpdGVtSWQgfSB9IH0pLmxlYW4oKVxuXG4gICAgaWYgKCFsYW5kcykgdGhyb3cgbmV3IEVycm9yKCd0aGlzIHZlZ2dpZSBpcyBub3Qgb24gYW55IGxhbmQgb2YgdGhpcyB1c2VyJylcblxuICAgIGxldCB1c2VyTGFuZHMgPSBbXVxuXG4gICAgbGFuZHMuZm9yRWFjaChsYW5kID0+IHtcblxuICAgICAgICBsZXQgdmVnZ2llID0gbGFuZC5wbGFudGF0aW9uLmZpbmQocGxhbnQgPT4gcGxhbnQudmVnZ2llLnRvU3RyaW5nKCkgPT09IGl0ZW1JZClcbiAgICAgICAgaWYgKHZlZ2dpZS50byAmJiB2ZWdnaWUuZnJvbSkge1xuICAgICAgICAgICAgdG8gPSB2ZWdnaWUudG9cbiAgICAgICAgICAgIGZyb20gPSB2ZWdnaWUuZnJvbVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRvICYmIGZyb20pIGdyb3d0aER1cmF0aW9uVXNlciA9IE1hdGguZmxvb3IoKHRvLmdldFRpbWUoKSAtIGZyb20uZ2V0VGltZSgpKSAvICgxMDAwICogNjAgKiA2MCAqIDI0KSlcblxuICAgICAgICB1c2VyTGFuZHMucHVzaChsYW5kLl9pZClcbiAgICB9KVxuXG4gICAgcmV0dXJuIHsgbGFuZHM6IHVzZXJMYW5kcywgLypncm93dGhEdXJhdGlvbiwqLyBncm93dGhEdXJhdGlvbkFsbCwgZ3Jvd3RoRHVyYXRpb25Vc2VyIH1cbn0iXX0=